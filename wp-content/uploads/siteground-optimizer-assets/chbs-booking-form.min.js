(function(a,c,d){"use strict";var b=function(q,o){var d=a(q),c=a.extend(p,o),h=[],k=0,b=this,p,f,l,m,g,j,e,i,n;this.setup=function(){var f=new CHBSHelper,e,d;if(f.getMessageFromConsole(),b.e('select,input[type="hidden"]').each(function(){a(this)[0].hasAttribute('data-value')&&a(this).val(a(this).attr('data-value'))}),parseInt(c.google_map_option.ask_load_enable,10)===1)if(isNaN(parseInt(b.e('[name="chbs_google_maps_enable"]').val(),10))){e=window.location.href,e.indexOf('?')===-1?e+='?':e+='&',confirm(c.message.google_map_ask_load_confirm)?window.location.href=e+'chbs_google_maps_enable=1':window.location.href=e+'chbs_google_maps_enable=-1';return}if(b.init(),parseInt(c.icon_field_enable,10)===1){for(d=1;d<=3;d++)b.e('input[name="chbs_pickup_date_service_type_'+d+'"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-date-1"></span>'),b.e('input[name="chbs_pickup_time_service_type_'+d+'"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-time-1"></span>'),b.e('input[name="chbs_return_date_service_type_'+d+'"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-date-1"></span>'),b.e('input[name="chbs_return_time_service_type_'+d+'"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-time-1"></span>');for(d=1;d<=2;d++)b.e('input[name="chbs_pickup_location_service_type_'+d+'"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-location-1"></span>'),b.e('input[name="chbs_dropoff_location_service_type_'+d+'"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-location-1"></span>');b.e('input[name="chbs_passenger_adult_service_type_1"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-passengers-1"></span>'),b.e('input[name="chbs_passenger_adult_service_type_3"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-passengers-1"></span>'),b.e('input[name="chbs_passenger_children_service_type_1"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-passengers-1"></span>'),b.e('input[name="chbs_passenger_children_service_type_3"]').before('<span class="chbs-meta-icon-2 chbs-meta-icon-2-passengers-1"></span>')}},this.init=function(){var f=new CHBSHelper,h,i,j,k;f.isMobile()&&(b.e('input[name="chbs_pickup_date_service_type_1"]').prop('readonly',!0),b.e('input[name="chbs_pickup_date_service_type_2"]').prop('readonly',!0),b.e('input[name="chbs_pickup_date_service_type_3"]').prop('readonly',!0),b.e('input[name="chbs_return_date_service_type_1"]').prop('readonly',!0),b.e('input[name="chbs_return_date_service_type_3"]').prop('readonly',!0)),b.createButtonRadio('.chbs-booking-extra'),a(window).resize(function(){try{b.e('select').selectmenu('close')}catch(a){}try{b.e('.chbs-datepicker').datepicker('hide')}catch(a){}try{b.e('.chbs-timepicker').timepicker('hide')}catch(a){}try{b.e('.ui-timepicker-wrapper').css({opacity:0})}catch(a){}try{var a=e.getCenter();google.maps.event.trigger(e,'resize'),e.setCenter(a)}catch(a){}}),b.setWidthClass(),parseInt(c.use_my_location_link_enable,10)===1&&navigator.geolocation&&(b.e('.chbs-my-location-link').css('display','inline'),navigator.geolocation.getCurrentPosition(b.myLocationSuccess,b.myLocationError)),h=1,i=b.e('.chbs-tab>ul').children('li[data-id="'+parseInt(b.e('[name="chbs_service_type_id"]').val())+'"]',10),i.length===1&&(h=i.index()),b.e('.chbs-tab').tabs({activate:function(d,e){a('.qtip').remove(),b.googleMapReInit();var c=b.getServiceTypeId();b.setServiceTypeId(c),b.showRideInfo(),b.googleMapCreate(),b.googleMapCreateRoute()},active:h}),b.e('.chbs-main-navigation-default a').on('click',function(e){var c,d;if(e.preventDefault(),c=parseInt(a(this).parent('li').data('step'),10),d=parseInt(b.e('input[name="chbs_step"]').val(),10),c-d===0)return;b.goToStep(c-d)}),b.e('.chbs-button-step-next').on('click',function(a){a.preventDefault(),b.goToStep(1)}),b.e('.chbs-button-step-prev').on('click',function(a){a.preventDefault(),b.goToStep(-1)}),b.e('.chbs-main-content').on('click','.chbs-form-field',function(b){if(a(this).find(':input[type="file"]').length)return;if(a('.qtip').remove(),b.preventDefault(),a(b.target).hasClass('chbs-location-add')||a(b.target).hasClass('chbs-location-remove'))return;a(this).find(':input').focus();var c=a(this).find('select:not(.chbs-selectmenu-disable)');c.length&&c.selectmenu('open')}),b.e('.chbs-location-add').on('click',function(h){var d,e,c,f,g;h.preventDefault(),d=a(this).parent('.chbs-form-field:first'),e=d.next('.chbs-form-field-waypoint-duration'),parseInt(e.length,10)===1&&(d=e),c=b.e('.chbs-form-field-location-autocomplete.chbs-hidden').clone(!0,!0),c.insertAfter(d),c.removeClass('chbs-hidden'),c.find(':input').focus(),f=b.e('.chbs-form-field-waypoint-duration.chbs-hidden'),parseInt(f.length,10)===1&&(g=f.clone(!0,!0),g.insertAfter(c),g.removeClass('chbs-hidden'),b.createSelectMenu(!1)),b.googleMapAutocompleteCreate(c.find('input[type="text"]')),b.reCalculateRoute(),b.createLabelTooltip()}),b.e('.chbs-location-remove').on('click',function(e){var c,d;e.preventDefault(),c=a(this).parent('.chbs-form-field:first'),d=c.next('.chbs-form-field-waypoint-duration'),d.find('select').selectmenu('destroy'),c.remove(),d.remove(),b.googleMapCreate(),b.googleMapCreateRoute()}),b.e('.chbs-form-field-location-autocomplete input[type="text"]').each(function(){b.googleMapAutocompleteCreate(a(this))}),b.e('.chbs-payment-form').on('click','.chbs-payment>li>a',function(c){c.preventDefault(),a(this).parents('.chbs-payment').find('li>a').removeClass('chbs-state-selected'),a(this).addClass('chbs-state-selected'),b.getGlobalNotice().addClass('chbs-hidden'),b.e('input[name="chbs_payment_id"]').val(a(this).attr('data-payment-id')),b.createSummaryPriceElement()}),b.e('>*').on('click','.chbs-form-checkbox',function(d){var b=a(this).next('input[type="hidden"]'),c=parseInt(b.val(),10)===1?0:1;c===1?a(this).addClass('chbs-state-selected'):a(this).removeClass('chbs-state-selected'),a(this).next('input[type="hidden"]').on('change',function(d){var c=parseInt(a(this).val(),10)===1?1:0,b=a(this).parents('.chbs-clear-fix:first').nextAll('.chbs-panel:first');c===0?b.addClass('chbs-hidden'):b.removeClass('chbs-hidden'),a(window).scroll()}),b.val(c).trigger('change')}),b.e('.chbs-booking-extra').on('click','.chbs-booking-extra-list .chbs-button.chbs-button-style-2',function(e){var c,d;e.preventDefault(),c=a(this).parents('li:first').find('.chbs-booking-form-extra-note'),a(this).parent('.chbs-button-radio').length?parseInt(a(this).attr('data-value'),10)!==0?c.removeClass('chbs-hidden'):c.addClass('chbs-hidden'):(a(this).toggleClass('chbs-state-selected'),a(this).hasClass('chbs-state-selected')?c.removeClass('chbs-hidden'):c.addClass('chbs-hidden')),d=[],b.e('.chbs-booking-extra-list .chbs-button.chbs-button-style-2').each(function(){a(this).hasClass('chbs-state-selected')&&d.push(a(this).attr('data-value'))}),b.e('input[name="chbs_booking_extra_id"]').val(d.join(',')),b.createSummaryPriceElement()}),b.e('.chbs-booking-extra').on('blur','.chbs-booking-extra-list input[type="text"]',function(c){isNaN(a(this).val())&&a(this).val(1),b.createSummaryPriceElement()}),b.e('.chbs-booking-extra').on('click','.chbs-booking-extra-list .chbs-column-2',function(){a(this).find('input[type="text"]').select()}),b.e('.chbs-main-content-step-2').on('click','.chbs-vehicle-list .chbs-button.chbs-button-style-2:not(.chbs-button-on-request)',function(d){if(d.preventDefault(),a(this).hasClass('chbs-state-selected'))return;b.e('.chbs-vehicle-list .chbs-button.chbs-button-style-2').removeClass('chbs-state-selected'),a(this).addClass('chbs-state-selected'),b.e('input[name="chbs_vehicle_id"]').val(parseInt(a(this).parents('.chbs-vehicle').attr('data-id'),10)),b.e('.chbs-vehicle-content-price-bid>div').addClass('chbs-hidden'),b.e('.chbs-vehicle-list [name="chbs_vehicle_bid_price[]"]').val(''),a(this).parents('.chbs-vehicle').find('.chbs-vehicle-content-price-bid>div:first-child').removeClass('chbs-hidden'),b.getGlobalNotice().addClass('chbs-hidden'),b.calculateBaseLocationDistance(function(){if(b.createSummaryPriceElement(),parseInt(c.scroll_to_booking_extra_after_select_vehicle_enable,10)===1){var d=b.e('.chbs-booking-extra-header');d.length===1&&a.scrollTo(d,200,{offset:-50})}b.manageBookingExtra()})}),b.e('.chbs-main-content-step-2').on('click','.chbs-vehicle .chbs-vehicle-content .chbs-show-more-button a',function(d){var b,c;d.preventDefault(),a(this).toggleClass('chbs-state-selected'),b=a(this).parents('.chbs-vehicle:first').find('.chbs-vehicle-content-description'),c=parseInt(b.children('div').actual('outerHeight',{includeMargin:!0}),10),b.hasClass('chbs-state-open')?b.animate({height:0},150,function(){b.removeClass('chbs-state-open'),a(window).scroll()}):b.animate({height:c},150,function(){b.css('height','auto'),b.addClass('chbs-state-open'),a(window).scroll()})}),b.e('.chbs-main-content-step-2').on('click','.chbs-booking-extra .chbs-booking-extra-header .chbs-show-more-button a',function(d){var b,c;d.preventDefault(),a(this).toggleClass('chbs-state-selected'),b=a(this).parents('.chbs-booking-extra:first').children('.chbs-booking-extra-header+div'),c=parseInt(b.children('div').actual('outerHeight',{includeMargin:!0}),10),b.hasClass('chbs-state-open')?b.animate({height:0},150,function(){b.removeClass('chbs-state-open'),a(window).scroll()}):b.animate({height:c},150,function(){b.css('height','auto'),b.addClass('chbs-state-open'),a(window).scroll()})}),b.e('.chbs-main-content-step-4').on('click','.chbs-summary .chbs-summary-header a',function(c){c.preventDefault(),b.goToStep(parseInt(a(this).attr('data-step'),10)-4)}),b.e('.chbs-main-content-step-4').on('click','.chbs-coupon-code-section a',function(d){d.preventDefault(),b.setAction('coupon_code_check'),b.post(b.e('form[name="chbs-form"]').serialize(),function(d){b.e('.chbs-summary-price-element').replaceWith(d.html);var e=b.e('.chbs-coupon-code-section');e.qtip({show:{target:a(this)},style:{classes:d.error===1?'chbs-qtip chbs-qtip-error':'chbs-qtip chbs-qtip-success'},content:{text:d.message},position:{my:c.is_rtl?'bottom right':'bottom left',at:c.is_rtl?'top right':'top left',container:e.parent()}}).qtip('show')})}),b.e('.chbs-main-content-step-4').on('click','.chbs-gratuity-section a',function(d){d.preventDefault(),b.setAction('gratuity_customer_set'),b.post(b.e('form[name="chbs-form"]').serialize(),function(d){b.e('.chbs-summary-price-element').replaceWith(d.html);var e=b.e('.chbs-gratuity-section');e.qtip({show:{target:a(this)},style:{classes:d.error===1?'chbs-qtip chbs-qtip-error':'chbs-qtip chbs-qtip-success'},content:{text:d.message},position:{my:c.is_rtl?'bottom right':'bottom left',at:c.is_rtl?'top right':'top left',container:e.parent()}}).qtip('show'),e.find('[name="chbs_gratuity_customer_value"]').val(d.gratuity)})}),b.e('.chbs-datepicker:not(.chbs-datepicker-form-element)').datepicker({autoSize:!0,minDate:c.datetime_min_format,maxDate:c.datetime_max_format,dateFormat:c.date_format_js,beforeShow:function(g,d){var h=new CHBSHelper,e=h.getValueFromClass(a(d.dpDiv),'chbs-booking-form-id-'),f,i;if(e!==!1&&a(d.dpDiv).removeClass('chbs-booking-form-id-'+e),a(d.dpDiv).addClass('chbs-booking-form-id-'+c.booking_form_id).addClass('chbs-datepicker'),a(g).attr('name')==='chbs_return_date_service_type_'+b.getServiceTypeId())try{f=b.e('[name="chbs_pickup_date_service_type_'+b.getServiceTypeId()+'"]').val(),i=a.datepicker.parseDate(c.date_format_js,f),i!==null&&a(this).datepicker('option','minDate',f)}catch(a){}},beforeShowDay:function(b){var g=new CHBSHelper,d=parseInt(b.getDay(),10),f,h,e;d===0&&(d=7),b=a.datepicker.formatDate('dd-mm-yy',b);for(f in c.date_exclude)if(h=g.compareDate([b,c.date_exclude[f].start,c.date_exclude[f].stop]),h)return[!1,'',''];return e=b.split('-'),b=new Date(e[2],e[1]-1,e[0]),!c.business_hour[d].start||!c.business_hour[d].stop?[!1,'','']:[!0,'','']},onSelect:function(r,o){var n=new CHBSHelper,f=[o.selectedDay,o.selectedMonth+1,o.selectedYear],m,e,p,g,k,j,h,i,q,l;for(m in f)new String(f[m]).length===1&&(f[m]='0'+f[m]);if(f=f[0]+'-'+f[1]+'-'+f[2],e=parseInt(a(this).datepicker('getDate').getDay(),10),e===0&&(e=7),p=a(this).attr('name').indexOf('pickup')>-1?'pickup':'return',g=b.e('input[name="chbs_'+p+'_time_service_type_'+b.getServiceTypeId()+'"]'),parseInt(c.pickup_time_field_write_enable,10)===1||p==='return'){if(k='',j='',(n.isEmpty(k)||n.isEmpty(j))&&new String(typeof c.business_hour[e])!=='undefined'&&(k=c.business_hour[e].start,j=c.business_hour[e].stop),h=c.datetime_min.split(' '),f===h[0]&&Date.parse('01/01/1970 '+h[1])>Date.parse('01/01/1970 '+k)&&(k=h[1]),n.isEmpty(c.datetime_max)||(h=c.datetime_max.split(' '),f===h[0]&&Date.parse('01/01/1970 '+h[1])<Date.parse('01/01/1970 '+j)&&(j=h[1])),i={appendTo:d,showOn:[],showOnFocus:!1,timeFormat:c.time_format,step:c.timepicker_step,disableTouchKeyboard:!0,minTime:k,maxTime:j,disableTextInput:parseInt(c.timepicker_field_readonly,10)===1},parseInt(c.timepicker_dropdown_list_enable,10)===1){try{g.timepicker('remove')}catch(a){}if(parseInt(b.getServiceTypeId(),10)===3){q=b.e('select[name="chbs_route_service_type_3"]>option:selected');try{l=JSON.parse(q.attr('data-time_exclude')),l[e]!=void 0&&(i.step=1,i.disableTextInput=!0,i.disableTimeRanges=l[e],i.maxTime=l[e][l[e].length-2][1])}catch(a){}}g.timepicker(i),g.val('').timepicker('show'),g.blur(),b.setTimepicker(g),parseInt(c.timepicker_hour_range_enable,10)===1&&(a('.ui-timepicker-list>li').each(function(){var b=[a(this),a(this).next()];b[1].length===1?b[0].html(b[0].text()+' - '+b[1].text()):b[0].remove()}),g.on('selectTime',function(c,d){var b=a('.ui-timepicker-list>.ui-timepicker-selected');b.length===1&&a(this).val(b.text())}))}}else new String(typeof c.business_hour[e])!=='undefined'&&g.val(c.business_hour[e].default)}}),a('.ui-datepicker').addClass('notranslate'),parseInt(c.timepicker_dropdown_list_enable,10)===1&&d.on('focusin','.chbs-timepicker:not(.chbs-timepicker-form-element)',function(){var c=new CHBSHelper,e=a(this).attr('name').indexOf('pickup')>-1?'pickup':'return',d=b.e('input[name="chbs_'+e+'_date_service_type_'+b.getServiceTypeId()+'"]');if(c.isEmpty(d.val())){a(this).timepicker('remove'),d.click();return}c.isEmpty(a(this).val())&&a(this).timepicker('show')}),b.createSelectMenu(),b.createFixedLocationAutocomplete(),b.e('.chbs-booking-extra').on('blur','.chbs-booking-extra-list input[type="text"]',function(){if(!a(this)[0].hasAttribute('data-quantity-max'))return;var c=a(this).val();isNaN(c)&&(c=1),c=parseInt(c,10),c>parseInt(a(this).attr('data-quantity-max'),10)&&a(this).val(a(this).attr('data-quantity-max')),b.createSummaryPriceElement()}),b.e('.chbs-form-field').has('select').css({cursor:'pointer'}),b.e('.chbs-main-content-step-3').on('click','.chbs-button-sign-up',function(a){a.preventDefault(),b.e('.chbs-client-form-sign-up').removeClass('chbs-hidden'),b.e('input[name="chbs_client_account"]').val(1)}),b.e('.chbs-main-content').on('click','.chbs-button-widget-submit',function(n){var i,d,f,e,j,h,k,l,g,m;n.preventDefault(),i=new CHBSHelper,d={},d.service_type_id=b.getServiceTypeId(),d.pickup_date=b.e('[name="chbs_pickup_date_service_type_'+d.service_type_id+'"]').val(),d.pickup_time=b.e('[name="chbs_pickup_time_service_type_'+d.service_type_id+'"]').val(),a.inArray(b.getServiceTypeId(),[1,2])>-1?(f=b.e('[name="chbs_pickup_location_coordinate_service_type_'+d.service_type_id+'"]').val(),i.isEmpty(f)||(e=JSON.parse(f),d.pickup_location_lat=e.lat,d.pickup_location_lng=e.lng,d.pickup_location_zip_code=e.zip_code,d.pickup_location_locality=e.locality,d.pickup_location_address=e.address,d.pickup_location_text=b.e('[name="chbs_pickup_location_service_type_'+d.service_type_id+'"]').val()),f=b.e('[name="chbs_dropoff_location_coordinate_service_type_'+d.service_type_id+'"]').val(),i.isEmpty(f)||(e=JSON.parse(f),d.dropoff_location_lat=e.lat,d.dropoff_location_lng=e.lng,d.dropoff_location_zip_code=e.zip_code,d.dropoff_location_locality=e.locality,d.dropoff_location_address=e.address,d.dropoff_location_text=b.e('[name="chbs_dropoff_location_service_type_'+d.service_type_id+'"]').val()),j=b.e('[name="chbs_fixed_location_pickup_service_type_'+d.service_type_id+'"]').val(),parseInt(j,10)>0&&(d.fixed_location_pickup_id=j),h=b.e('[name="chbs_fixed_location_dropoff_service_type_'+d.service_type_id+'"]').val(),parseInt(h,10)>0&&(d.fixed_location_dropoff_id=h)):d.route_id=b.e('[name="chbs_route_service_type_'+d.service_type_id+'"]').val(),a.inArray(b.getServiceTypeId(),[1,3])>-1&&(d.extra_time=b.e('[name="chbs_extra_time_service_type_'+d.service_type_id+'"]').val(),d.transfer_type=b.e('[name="chbs_transfer_type_service_type_'+d.service_type_id+'"]').val(),a.inArray(d.transfer_type,[3])&&(d.duration=b.e('[name="chbs_duration_service_type_'+d.service_type_id+'"]').val(),d.return_date=b.e('[name="chbs_return_date_service_type_'+d.service_type_id+'"]').val(),d.return_time=b.e('[name="chbs_return_time_service_type_'+d.service_type_id+'"]').val())),a.inArray(b.getServiceTypeId(),[2])>-1&&(d.duration=b.e('[name="chbs_duration_service_type_'+d.service_type_id+'"]').val()),k=b.e('[name="chbs_passenger_adult_service_type_'+d.service_type_id+'"]'),k.length===1&&(d.passenger_adult=k.val()),l=b.e('[name="chbs_passenger_children_service_type_'+d.service_type_id+'"]'),l.length===1&&(d.passenger_children=l.val()),d.currency=b.e('[name="chbs_currency"]').val(),d.widget_submit=1,d.widget_second_step=parseInt(b.e('[name="chbs_widget_second_step"]').val(),10),g=c.widget.booking_form_url,g.indexOf('?')===-1?g+='?':g+='&',g+=decodeURI(a.param(d)),m=b.e('form[name="chbs-form"]'),m.attr('action',g).submit()}),b.e('.chbs-main-content-step-3').on('click','.chbs-button-sign-in',function(a){a.preventDefault(),b.getGlobalNotice().addClass('chbs-hidden'),b.preloader(!0),b.setAction('user_sign_in'),b.post(b.e('form[name="chbs-form"]').serialize(),function(a){parseInt(a.user_sign_in,10)===1?(b.e('.chbs-main-content-step-3 .chbs-client-form').html(''),typeof a.client_form_sign_up!='undefined'&&b.e('.chbs-main-content-step-3 .chbs-client-form').append(a.client_form_sign_up),typeof a.summary!='undefined'&&b.e('.chbs-main-content-step-3>.chbs-layout-25x75 .chbs-layout-column-left:first').html(a.summary[0]),b.createSelectMenu(),b.createFixedLocationAutocomplete()):typeof a.error.global[0]!='undefined'&&b.getGlobalNotice().removeClass('chbs-hidden').html(a.error.global[0].message),b.preloader(!1)})}),b.e('.chbs-main-content-step-3').on('click','.chbs-sign-up-password-generate',function(d){var a,c;d.preventDefault(),a=new CHBSHelper,c=a.generatePassword(8),b.e('input[name="chbs_client_sign_up_password"],input[name="chbs_client_sign_up_password_retype"]').val(c)}),b.e('.chbs-main-content-step-3').on('click','.chbs-sign-up-password-show',function(c){c.preventDefault();var a=b.e('input[name="chbs_client_sign_up_password"]');a.attr('type',a.attr('type')==='password'?'text':'password')}),a(document).bind('keypress',function(c){if(parseInt(c.which,10)===13)switch(a(c.target).attr('name')){case'chbs_client_sign_in_login':case'chbs_client_sign_in_password':b.e('.chbs-main-content-step-3 .chbs-button-sign-in').trigger('click');break}}),a(document).unbind('keydown').bind('keydown',function(c){switch(a(c.target).attr('name')){case'chbs_passenger_adult_service_type_1':case'chbs_passenger_adult_service_type_2':case'chbs_passenger_adult_service_type_3':case'chbs_passenger_children_service_type_1':case'chbs_passenger_children_service_type_2':case'chbs_passenger_children_service_type_3':if(a.inArray(parseInt(c.keyCode,10),[38,40])>-1){var b=parseInt(a(c.target).val(),10);isNaN(b)&&(b=0),parseInt(c.keyCode,10)===38?b=b+1>99?99:b+1:parseInt(c.keyCode,10)===40&&(b=b-1<0?0:b-1),a(c.target).val(parseInt(b))}break}}),b.e('.chbs-main-content-step-2').on('click','.chbs-quantity-section .chbs-quantity-section-button',function(g){var b=a(this).parent().children('input[type="text"]'),d,c,e,f;if(parseInt(b.length,10)!==1)return;if(d=parseInt(a(this).attr('data-step'),10),c=parseInt(b.val(),10),e=1,f=parseInt(b.attr('data-quantity-max'),10),c+=d,c<e||c>f)return;b.val(c),a(this).parents('li:first').find('.chbs-column-3 .chbs-button').removeClass('chbs-state-selected'),a(this).parents('li:first').find('.chbs-column-3 .chbs-button:first').trigger('click')}),b.e('.chbs-main-content-step-2 .chbs-vehicle-list').on('click','.chbs-pagination a',function(j){var c,f,g,e,h,d,i;if(j.preventDefault(),c=0,f=parseInt(a(this).parent('.chbs-pagination').attr('data-vehicle_per_page'),10),g=b.e('.chbs-vehicle-list>ul>li').length,e=0,b.e('.chbs-vehicle-list>ul>li').each(function(){c++,!a(this).hasClass('chbs-hidden')&&e===0&&(e=c)}),h=parseInt(a(this).attr('href').substr(1),10),d=e+h*f,i=d+f,d>g)return;if(d<=0)return;c=0,b.e('.chbs-vehicle-list>ul>li').each(function(){c++,a(this).addClass('chbs-hidden'),c>=d&&c<i&&a(this).removeClass('chbs-hidden')})}),b.createLabelTooltip(),b.googleMapCreate(),b.googleMapInit(),j=b.e('[name="chbs_route_service_type_3"]>option:first'),parseInt(j.val(),10)===-1&&typeof g!='undefined'&&(k=[{lat:g.lat(),lng:g.lng()}],j.attr('data-coordinate',JSON.stringify(k))),b.googleMapCreateRoute(function(){parseInt(f.urlParam('widget_submit'),10)===1&&parseInt(f.urlParam('widget_second_step'),10)===1?b.goToStep(1,function(){d.removeClass('chbs-hidden'),b.createStickySidebar(),a(window).scroll()}):d.removeClass('chbs-hidden'),b.googleMapStartCustomizeHeight()}),b.moveSubmitButton(),b.setBidPriceVehicle(),b.showRideInfo()},this.showRideInfo=function(){var a=b.getServiceTypeId();parseInt(a,10)===2?b.e('.chbs-ride-info>div:first').addClass('chbs-hidden'):b.e('.chbs-ride-info>div:first').removeClass('chbs-hidden')},this.myLocationSuccess=function(a){b.e('.chbs-my-location-link').on('click',function(){var d={lat:a.coords.latitude,lng:a.coords.longitude},c=b.e('input[name="chbs_pickup_location_coordinate_service_type_'+b.getServiceTypeId()+'"]');c.val(JSON.stringify(d)),b.googleMapSetAddress(c,function(){b.googleMapCreate(),b.googleMapCreateRoute()},!0)})},this.myLocationError=function(a){console.log(a)},this.getVehicleSelectedId=function(){var a=parseInt(b.e('.chbs-vehicle .chbs-vehicle-content-header .chbs-button.chbs-state-selected').parents('.chbs-vehicle').attr('data-id'),10);return a},this.setBidPriceVehicle=function(){b.e('.chbs-main-content-step-2'),b.e('.chbs-main-content-step-2').on('click','.chbs-vehicle-content-price-bid>div:first-child>a',function(b){b.preventDefault(),a(this).parent('div').addClass('chbs-hidden'),a(this).parent('div').next('div').removeClass('chbs-hidden')}),b.e('.chbs-main-content-step-2').on('click','.chbs-vehicle-content-price-bid>div+div>input+a',function(c){var d=a(this).prev('input');c.preventDefault(),b.setAction('vehicle_bid_price_check'),b.preloader(!0),b.post(b.e('form[name="chbs-form"]').serialize(),function(a){b.preloader(!1),typeof a.html!='undefined'&&(typeof a.bid_vehicle_min_value!='undefined'?confirm(a.bid_question)?(d.val(a.bid_vehicle_min_value),b.preloader(!0),b.post(b.e('form[name="chbs-form"]').serialize(),function(a){b.preloader(!1),typeof a.html!='undefined'&&b.e('.chbs-summary-price-element').replaceWith(a.html)})):(b.e('.chbs-summary-price-element').replaceWith(a.html),typeof a.bid_notice!='undefined'&&alert(a.bid_notice)):(b.e('.chbs-summary-price-element').replaceWith(a.html),typeof a.bid_notice!='undefined'&&alert(a.bid_notice)))})}),b.e('.chbs-main-content-step-2').on('click','.chbs-vehicle-content-price-bid>div+div>input+a+a',function(c){c.preventDefault(),a(this).parent('div').addClass('chbs-hidden'),a(this).parent('div').prev('div').removeClass('chbs-hidden'),a(this).parent('div').find('input[type="text"]').val(''),b.setAction('vehicle_bid_price_check'),b.post(b.e('form[name="chbs-form"]').serialize(),function(a){typeof a.html!='undefined'&&b.e('.chbs-summary-price-element').replaceWith(a.html)})})},this.setPayment=function(){var a=parseInt(b.e('input[name="chbs_payment_id"]').val(),10);a>0&&b.e('.chbs-payment>li>a[data-payment-id="'+a+'"]').addClass('chbs-state-selected')},this.moveSubmitButton=function(){if(d.hasClass('chbs-widget')&&d.hasClass('chbs-widget')&&d.hasClass('chbs-widget-style-2')){var a=b.e('.chbs-main-content-step-1 .chbs-button-widget-submit').parent();a.clone().appendTo(b.e('#panel-1')),a.clone().appendTo(b.e('#panel-2')),a.clone().appendTo(b.e('#panel-3')),a.remove()}},this.convertTimeToMinute=function(a){return a=a.split(':'),a[0]*60+a[1]},this.createLabelTooltip=function(){b.e('.chbs-tooltip').qtip({style:{classes:'chbs-qtip chbs-qtip-success'},position:{my:'bottom left',at:'top left',container:d}})},this.setTimepicker=function(b){(parseInt(c.timepicker_dropdown_list_enable,10)===1||b.hasClass('chbs-timepicker-form-element'))&&a('.ui-timepicker-wrapper').css({opacity:1,width:b.parent('div').outerWidth()+1})},this.createFormElementFieldDatePicker=function(){var d={autoSize:!0,dateFormat:c.date_format_js,beforeShow:function(f,b){var e=new CHBSHelper,d=e.getValueFromClass(a(b.dpDiv),'chbs-booking-form-id-');d!==!1&&a(b.dpDiv).removeClass('chbs-booking-form-id-'+d),a(b.dpDiv).addClass('chbs-booking-form-id-'+c.booking_form_id).addClass('chbs-datepicker')}};b.e('.chbs-datepicker.chbs-datepicker-form-element').datepicker(d)},this.createFormElementFieldTimePicker=function(){b.e('.chbs-main-content').on('click','.chbs-timepicker.chbs-timepicker-form-element',function(f){var e={showOn:[],appendTo:d,showOnFocus:!1,timeFormat:c.time_format};a(this).timepicker(e),a(this).val('').timepicker('show'),a(this).blur(),b.setTimepicker(a(this))})},this.createFormElementFieldAutocomplete=function(){var d=new CHBSHelper;b.e('.chbs-autocomplete-form-element').each(function(){var f='chbs_autocomplete_form_element_'+d.getRandomString(16),e,g;a(this).attr('id',f),e=a(this),g=new google.maps.places.Autocomplete(document.getElementById(f),o),g.addListener('place_changed',function(h){var d=g.getPlace(),f;if(!d.geometry)return alert(c.message.place_geometry_error),e.val(''),!1;f={lat:d.geometry.location.lat(),lng:d.geometry.location.lng(),address:b.removeDoubleQuote(e.val()),zip_code:b.getZipCode(d)},a(e).siblings('input[type="hidden"]').val(JSON.stringify(f))})})},this.createFileField=function(){b.e('input[type="file"]').each(function(){var d=a(this);a(this).fileupload({url:c.ajax_url,dataType:'json',formData:{action:'chbs_file_upload'},done:function(c,a){b.setFileUploadField(d,!0,a.result)}}),a(this).parent('.chbs-file-upload').next('.chbs-file-remove').children('span:last-child').on('click',function(a){a.preventDefault(),b.setFileUploadField(d,!1,[])})})},this.setFileUploadField=function(e,f,a){var c=e.attr('name'),d=b.e('input[name="'+c+'"]');f?(d.parent('.chbs-file-upload').addClass('chbs-hidden'),d.parent('.chbs-file-upload').next('.chbs-file-remove').removeClass('chbs-hidden').find('span>span').html(a.name)):(d.parent('.chbs-file-upload').removeClass('chbs-hidden'),d.parent('.chbs-file-upload').next('.chbs-file-remove').addClass('chbs-hidden').find('span>span').html(''),a={name:'',type:'',tmp_name:''}),b.e('input[name="'+c+'_name"]').val(a.name),b.e('input[name="'+c+'_type"]').val(a.type),b.e('input[name="'+c+'_tmp_name"]').val(a.tmp_name)},this.createSelectMenu=function(h=!0){var e='select',c,f,g,i;h&&(e+=':not(.chbs-selectmenu-disable)'),b.e(e).selectmenu({appendTo:d,open:function(h,i){var c=a(this),d=a('#'+c.attr('id')+'-menu').parent('div'),b=c.parents('.chbs-form-field:first'),g=parseInt(d.css('left'),10)-1,e=parseInt(b.css('border-left-width'),10)+parseInt(b.css('border-right-width'),10),f=b[0].getBoundingClientRect().width-e;d.css({width:f+2,left:g})},change:function(g,h){var c=a(this).attr('name'),d,e,f;if(c==='chbs_waypoint_duration_service_type_1[]'&&b.reCalculateRoute(),c==='chbs_route_service_type_3'&&(b.googleMapCreate(),b.googleMapCreateRoute()),a.inArray(c,['chbs_transfer_type_service_type_1','chbs_transfer_type_service_type_3'])>-1&&(d=b.e('[name="chbs_return_date_service_type_'+b.getServiceTypeId()+'"]').parent('div').parent('div'),parseInt(a(this).val(),10)===3?d.removeClass('chbs-hidden'):d.addClass('chbs-hidden')),a.inArray(c,['chbs_extra_time_service_type_1','chbs_transfer_type_service_type_1','chbs_duration_service_type_2','chbs_extra_time_service_type_3','chbs_transfer_type_service_type_3'])>-1&&b.reCalculateRoute(),c==='chbs_navigation_responsive'){if(e=parseInt(a(this).val(),10),f=parseInt(b.e('input[name="chbs_step"]').val(),10),e-f===0)return;b.goToStep(e-f)}a.inArray(c,['chbs_vehicle_passenger_count','chbs_vehicle_bag_count','chbs_vehicle_standard','chbs_vehicle_category'])>-1&&(b.setAction('vehicle_filter'),b.e('.chbs-vehicle-list').children().addClass('chbs-hidden'),b.e('.chbs-vehicle-list').addClass('chbs-preloader-1'),b.post(b.e('form[name="chbs-form"]').serialize(),function(a){b.getGlobalNotice().addClass('chbs-hidden');var c=b.e('.chbs-vehicle-list');c.html('').removeClass('chbs-preloader-1'),typeof a.error!='undefined'&&typeof a.error.global!='undefined'?b.getGlobalNotice().removeClass('chbs-hidden').html(a.error.global[0].message):(c.html(a.html),b.recalculateVehiclePrice(a,1)),b.e('.chbs-vehicle-list').find('.chbs-button.chbs-button-style-2').removeClass('chbs-state-selected'),b.preloadVehicleImage(),b.e('input[name="chbs_vehicle_id"]').val(0),b.createSummaryPriceElement()})),a.inArray(c,['chbs_fixed_location_pickup_service_type_1','chbs_fixed_location_dropoff_service_type_1','chbs_fixed_location_pickup_service_type_2','chbs_fixed_location_dropoff_service_type_3']>-1)&&b.googleMapSetAddress(a(this),function(){b.googleMapCreate(),b.googleMapCreateRoute()}),a.inArray(c,['chbs_fixed_location_pickup_service_type_1','chbs_fixed_location_pickup_service_type_2']>-1)&&b.checkFixedLocationPickup(c),a.inArray(c,['chbs_fixed_location_dropoff_service_type_1']>-1)&&b.checkFixedLocationPickup('chbs_fixed_location_pickup_service_type_1'),a.inArray(c,['chbs_fixed_location_dropoff_service_type_2']>-1)&&b.checkFixedLocationPickup('chbs_fixed_location_pickup_service_type_2')}}),b.e('.ui-selectmenu-button .ui-icon.ui-icon-triangle-1-s').attr('class','chbs-meta-icon-arrow-vertical-large'),b.checkFixedLocationPickup('chbs_fixed_location_pickup_service_type_1'),b.checkFixedLocationPickup('chbs_fixed_location_pickup_service_type_2'),c=[1,3];for(f in c)g=b.e('[name="chbs_transfer_type_service_type_'+c[f]+'"]'),g.length===1&&parseInt(g.val(),10)===3&&(i=b.e('[name="chbs_return_date_service_type_'+c[f]+'"]'),i.parents('.chbs-form-field').parent('.chbs-clear-fix').removeClass('chbs-hidden'))},this.getFixedLocationSource=function(c){var b=[];return a(c).next('select').find('option:not([disabled="disabled"])').each(function(c,a){b.push({label:a.text,value:a.value})}),b},this.createFixedLocationAutocomplete=function(){b.e('.chbs-form-field-location-fixed-autocomplete').each(function(f,c){var e=b.getFixedLocationSource(c);e.length&&(a(c).autocomplete({appendTo:d,source:e,minLength:0,focus:function(a,b){a.preventDefault()},select:b.handleFixedLocationAutocompleteChange,change:b.handleFixedLocationAutocompleteChange}).focus(function(){a(this).autocomplete('search')}),a.ui.autocomplete.filter=function(b,c){var d=new RegExp('^'+a.ui.autocomplete.escapeRegex(c),'i');return a.grep(b,function(a){return d.test(a.label||a.value||a)})})})},this.handleFixedLocationAutocompleteChange=function(d,f){d.preventDefault();var e=a(d.target).next('select'),c=e.attr('name');f.item==null?(a(d.target).val(''),e.val('')):(a(d.target).val(f.item.label),e.val(f.item.value)),a.inArray(c,['chbs_fixed_location_pickup_service_type_1','chbs_fixed_location_dropoff_service_type_1','chbs_fixed_location_pickup_service_type_2','chbs_fixed_location_dropoff_service_type_3']>-1)&&b.googleMapSetAddress(e,function(){b.googleMapCreate(),b.googleMapCreateRoute()}),a.inArray(c,['chbs_fixed_location_pickup_service_type_1','chbs_fixed_location_pickup_service_type_2']>-1)&&b.checkFixedLocationPickup(c),a.inArray(c,['chbs_fixed_location_dropoff_service_type_1']>-1)&&b.checkFixedLocationPickup('chbs_fixed_location_pickup_service_type_1'),a.inArray(c,['chbs_fixed_location_dropoff_service_type_2']>-1)&&b.checkFixedLocationPickup('chbs_fixed_location_pickup_service_type_2')},this.checkFixedLocationPickup=function(e){var f=e.replace('pickup','dropoff'),d=b.e('[name="'+f+'"]'),c,g;d.children('option').removeAttr('disabled');try{d.selectmenu('refresh')}catch(a){}if(c=b.e('select[name="'+e+'"]').children('option:selected').attr('data-location'),typeof c=='undefined')return;if(c=JSON.parse(c),!c.dropoff_disable.length)return;for(g in c.dropoff_disable)d.children('option[value="'+c.dropoff_disable[g]+'"]').attr('disabled','disabled').removeAttr('selected');try{d.selectmenu('refresh')}catch(a){}b.e('.chbs-form-field-location-fixed-autocomplete').each(function(e,c){var d=b.getFixedLocationSource(c);a(c).autocomplete({source:d})})},this.setMainNavigation=function(){var d=parseInt(b.e('input[name="chbs_step"]').val(),10),c=b.e('.chbs-main-navigation-default').find('li'),e;c.removeClass('chbs-state-selected').removeClass('chbs-state-completed'),c.filter('[data-step="'+d+'"]').addClass('chbs-state-selected'),e=0,c.each(function(){if(++e>=d)return;a(this).addClass('chbs-state-completed')})},this.getServiceTypeId=function(){return parseInt(b.e('.ui-tabs .ui-tabs-active').attr('data-id'),10)},this.setServiceTypeId=function(a){b.e('input[name="chbs_service_type_id"]').val(a)},this.setAction=function(a){b.e('input[name="action"]').val('chbs_'+a)},this.e=function(a){return d.find(a)},this.recalculateVehiclePrice=function(f,g){var c,d,e;if(parseInt(f.booking_summary_hide_fee,10)===1&&parseInt(g,10)===1)if(c=[],b.e('.chbs-vehicle-list>ul>li').each(function(){var d=new CHBSHelper,b=a(this).children('div:first');!d.isEmpty(b.attr('data-base_location_cooridnate_lat'))&&!d.isEmpty(b.attr('data-base_location_cooridnate_lng'))&&c.push({id:b.attr('data-id'),lat:b.attr('data-base_location_cooridnate_lat'),lng:b.attr('data-base_location_cooridnate_lng')})}),c.length){b.e('.chbs-vehicle-list').children().addClass('chbs-hidden'),b.e('.chbs-vehicle-list').addClass('chbs-preloader-1'),d=0;for(e in c)b.calculateBaseLocationDistance(function(a){d++;var e=b.e('.chbs-vehicle-list .chbs-vehicle[data-id="'+a.id+'"]');if(e.find('[name="chbs_base_location_vehicle_distance['+a.id+']"]').val(a.distance),e.find('[name="chbs_base_location_vehicle_return_distance['+a.id+']"]').val(a.return_distance),d===c.length){b.goToStep(0);return}},c[e])}},this.goToStep=function(g,h,q=!0){var k,f,n,l,m,j,o,p;if(b.preloader(!0),k=b.e('input[name="chbs_step"]'),f=b.e('input[name="chbs_step_request"]'),parseInt(c.recaptcha.enable,10)===1)if(n=parseInt(k.val(),10)+g,n>=1)if(q){l=parseInt(c.recaptcha.api_type,10)===1?grecaptcha:grecaptcha.enterprise,l.ready(function(){l.execute(c.recaptcha.site_key).then(function(a){b.e('[name="chbs_recaptcha_token"]').val(a),b.goToStep(g,h,!1)})});return}b.setAction('go_to_step'),b.setServiceTypeId(b.getServiceTypeId()),f.val(parseInt(k.val(),10)+g),m=b.getServiceTypeId(),parseInt(f.val(),10)===2&&(j=parseInt(b.e('[name="chbs_passenger_adult_service_type_'+m+'"]').val(),10)+parseInt(b.e('[name="chbs_passenger_children_service_type_'+m+'"]').val(),10),j>0&&b.e('[name="chbs_vehicle_passenger_count"]').val(j)),parseInt(f.val(),10)===4&&i&&(o=b.e('input[name="chbs_client_contact_detail_phone_number"]'),p=i.getNumber(),o.val(p)),b.post(b.e('form[name="chbs-form"]').serialize(),function(f){var p=b.e('input[name="chbs_step"]').val(),n,l,m,k,g,i,j,q,o;switch(f.step=parseInt(f.step,10),b.getGlobalNotice().addClass('chbs-hidden'),b.e('.chbs-main-content>div').css('display','none'),b.e('.chbs-main-content>div:eq('+(f.step-1)+')').css('display','block'),b.e('input[name="chbs_step"]').val(f.step),b.setMainNavigation(),b.googleMapDuplicate(-1),google.maps.event.trigger(e,'resize'),b.e('select[name="chbs_navigation_responsive"]').val(f.step),b.e('select[name="chbs_navigation_responsive"]').selectmenu('refresh'),parseInt(f.step,10)===1?b.googleMapStartCustomizeHeight():b.googleMapStopCustomizeHeight(),parseInt(f.step,10)){case 2:if(typeof f.redirect_to_url_address!='undefined'){a('body').css({display:'none'}),window.location.href=f.redirect_to_url_address;break}b.e('.chbs-vehicle-filter>.chbs-form-field>select[name="chbs_vehicle_passenger_count"]').replaceWith(f.vehicle_passenger_filter_field),typeof f.vehicle!='undefined'&&(b.e('.chbs-vehicle-list').removeClass('chbs-preloader-1'),b.e('.chbs-vehicle-list').html(f.vehicle),b.recalculateVehiclePrice(f,p)),typeof f.booking_extra!='undefined'&&b.e('.chbs-booking-extra').html(f.booking_extra),typeof f.summary!='undefined'&&b.e('.chbs-main-content-step-2>.chbs-layout-25x75 .chbs-layout-column-left:first').html(f.summary[0]),b.preloadVehicleImage(),b.createVehicleGallery(),b.createSelectMenu(),b.createFixedLocationAutocomplete(),b.manageBookingExtra();break;case 3:typeof f.client_form_sign_in!='undefined'&&typeof f.client_form_sign_up!='undefined'&&(b.e('.chbs-main-content-step-3 .chbs-client-form').html(''),typeof f.client_form_sign_in!='undefined'&&b.e('.chbs-main-content-step-3 .chbs-client-form').prepend(f.client_form_sign_in),typeof f.client_form_sign_up!='undefined'&&b.e('.chbs-main-content-step-3 .chbs-client-form').append(f.client_form_sign_up),typeof f.payment_form!='undefined'&&b.e('.chbs-main-content-step-3 .chbs-payment-form').html(f.payment_form)),typeof f.summary!='undefined'&&b.e('.chbs-main-content-step-3>.chbs-layout-25x75 .chbs-layout-column-left:first').html(f.summary[0]),b.setPayment(),b.createFileField(),b.createSelectMenu(),b.createFixedLocationAutocomplete(),b.createFormElementFieldDatePicker(),b.createFormElementFieldTimePicker(),b.createFormElementFieldAutocomplete();break;case 4:typeof f.summary!='undefined'&&(b.e('.chbs-main-content-step-4>.chbs-layout-33x33x33>.chbs-layout-column-left').html(f.summary[0]),b.e('.chbs-main-content-step-4>.chbs-layout-33x33x33>.chbs-layout-column-center').html(f.summary[1]),b.e('.chbs-main-content-step-4>.chbs-layout-33x33x33>.chbs-layout-column-right').html(f.summary[2])),b.e('.chbs-agreement-header,.chbs-agreement').remove(),typeof f.agreement_html!='undefined'&&b.e('.chbs-main-content-step-4>.chbs-layout-33x33x33').after(f.agreement_html);break}if(b.createPhoneField(),b.createLabelTooltip(),b.createStickySidebar(),a(window).scroll(),a.inArray(f.step,[4])>-1&&b.googleMapDuplicate(f.step),a('.qtip').remove(),typeof f.error!='undefined')if(typeof f.error.global[0]!='undefined'&&b.getGlobalNotice().removeClass('chbs-hidden').html(f.error.global[0].message),typeof f.error.local!='undefined')for(n in f.error.local)k=f.error.local[n].field.split('-'),isNaN(k[1])?l='[name="'+k[0]+'"]:eq(0)':l='[name="'+k[0]+'[]"]:eq('+k[1]+')',m=b.e(l).prevAll('label'),m.qtip({show:{target:a(this)},style:{classes:f.error===1?'chbs-qtip chbs-qtip-error':'chbs-qtip chbs-qtip-success'},content:{text:f.error.local[n].message},position:{my:c.rtl_mode?'bottom right':'bottom left',at:c.rtl_mode?'top right':'top left',container:m.parents('[name="chbs-form"]')}}).qtip('show');if(parseInt(f.step,10)===5)if(b.e('.chbs-main-navigation-default').addClass('chbs-hidden'),b.e('.chbs-main-navigation-responsive').addClass('chbs-hidden'),typeof f.error!='undefined')b.getGlobalNotice().removeClass('chbs-hidden').html(f.error.global[0].message);else switch(typeof f.redirect_to_woocommerce_cart_enable!='undefined'&&parseInt(f.redirect_to_woocommerce_cart_enable,10)===1&&(a('body').css('display','none'),window.location.href=f.redirect_to_woocommerce_cart_url_address),a.inArray(parseInt(f.payment_id,10),[1,2,3,4,5])>-1&&(g=new CHBSHelper,g.isEmpty(f.payment_info)||b.e('.chbs-booking-complete-payment-'+f.payment_prefix).append('<p>'+f.payment_info+'</p>')),parseInt(f.payment_id,10)){case-2:g.isEmpty(f.payment_disable_success_url_address)||(a('body').css('display','none'),window.location.href=f.payment_disable_success_url_address),b.e('.chbs-booking-complete-payment-disable').css('display','block');break;case-1:parseInt(f.thank_you_page_enable,10)!==1?(a('body').css('display','none'),window.location.href=f.payment_url):(b.e('.chbs-booking-complete-payment-woocommerce').css('display','block'),b.e('.chbs-booking-complete-payment-woocommerce>a').attr('href',f.payment_url));break;case 1:g.isEmpty(f.payment_cash_success_url_address)||(a('body').css('display','none'),window.location.href=f.payment_cash_success_url_address),b.e('.chbs-booking-complete-payment-cash').css('display','block');break;case 2:a('body').css('display','none'),a.getScript('https://js.stripe.com/v3/',function(){var e=Stripe(f.stripe_publishable_key),c=b.e('.chbs-booking-complete-payment-stripe'),d,g;b.e('.chbs-booking-complete').on('click','.chbs-booking-complete-payment-stripe a',function(a){a.preventDefault(),e.redirectToCheckout({sessionId:f.stripe_session_id}).then(function(a){})}),d=parseInt(f.stripe_redirect_duration,10),d<=0?c.find('a').trigger('click'):(a('body').css('display','block'),c.css('display','block'),g=setInterval(function(){d--,c.find('div>span').html(d),d===0&&(clearInterval(g),c.find('a').trigger('click'))},1e3))});break;case 3:a('body').css('display','none'),i=b.e('.chbs-booking-complete-payment-paypal'),b.e('.chbs-booking-complete').on('click','.chbs-booking-complete-payment-paypal a',function(d){var a,c;d.preventDefault(),a=b.e('form[name="chbs-form-paypal"]');for(c in f.form)a.find('input[name="'+c+'"]').val(f.form[c]);a.submit()}),j=parseInt(f.payment_paypal_redirect_duration,10),j<=0?i.find('a').trigger('click'):(a('body').css('display','block'),i.css('display','block'),q=setInterval(function(){j--,i.find('div>span').html(j),j===0&&(clearInterval(q),i.find('a').trigger('click'))},1e3));break;case 4:g.isEmpty(f.payment_wire_transfer_success_url_address)||(a('body').css('display','none'),window.location.href=f.payment_wire_transfer_success_url_address),b.e('.chbs-booking-complete-payment-wire-transfer').css('display','block');break;case 5:g.isEmpty(f.payment_credit_card_pickup_success_url_address)||(a('body').css('display','none'),window.location.href=f.payment_credit_card_pickup_success_url_address),b.e('.chbs-booking-complete-payment-credit-card-pickup').css('display','block');break}o=20,a('#wpadminbar').length===1&&(o+=a('#wpadminbar').height()),a.scrollTo(d,{offset:-1*o}),typeof h!='undefined'&&h(),b.preloader(!1)})},this.createPhoneField=function(){var d=b.e('input[name="chbs_client_contact_detail_phone_number"]'),a=b.e('input[name="chbs_client_contact_detail_phone_number_placeholder"]');parseInt(a.length,10)===1&&(i=window.intlTelInput(a[0],{initialCountry:c.client_country_code,separateDialCode:!0}),i.setNumber(d.val()),a[0].addEventListener('countrychange',function(){var a=i.getNumber();d.val(a)}))},this.manageBookingExtra=function(){var c=b.e('.chbs-booking-extra-list'),d=b.e('.chbs-booking-extra-category-list'),g,f,e;if(c.length!==1)return;parseInt(d.length)===1&&(c.addClass('chbs-hidden'),d.find('>div>a').off('click'),d.find('>div>a').on('click',function(d){d.preventDefault();var e=a(this).attr('data-category_id');if(c=b.e('.chbs-booking-extra-list'),a(this).next('.chbs-booking-extra-list').length===1)if(!a(this).next('.chbs-booking-extra-list').hasClass('chbs-hidden')){a(this).next('.chbs-booking-extra-list').addClass('chbs-hidden');return}c.find('li').each(function(){a.inArray(e,a(this).attr('data-category_id').split(','))>-1?a(this).removeClass('chbs-hidden-by-category'):a(this).addClass('chbs-hidden-by-category')}),a(this).after(c),c.removeClass('chbs-hidden')})),g=b.e('[name="chbs_vehicle_id"]').val(),c=b.e('.chbs-booking-extra-list'),c.find('li:not(.chbs-hidden-by-category)').each(function(){var b=a(this).attr('data-vehicle_id').split(',');a.inArray('-1',b)>-1||a.inArray(g,b)>-1?a(this).removeClass('chbs-hidden'):(a(this).addClass('chbs-hidden'),a(this).find('.chbs-button.chbs-button-style-2').removeClass('.chbs-state-selected'))}),c=b.e('.chbs-booking-extra-list'),f=[],c.find('.chbs-button.chbs-button-style-2').each(function(){a(this).hasClass('chbs-state-selected')&&f.push(a(this).attr('data-value'))}),e=[f.join(','),b.e('input[name="chbs_booking_extra_id"]').val()],new String(e[0])!==new String(e[1])&&(b.e('input[name="chbs_booking_extra_id"]').val(e[0]),b.createSummaryPriceElement())},this.post=function(b,d){a.post(c.ajax_url,b,function(a){d(a)},'json')},this.preloader=function(a){b.e('#chbs-preloader').css('display',a?'block':'none')},this.preloadVehicleImage=function(){try{b.e('.chbs-vehicle-list .chbs-vehicle-image img').one('load',function(){a(this).parent('.chbs-vehicle-image').animate({opacity:1},300)}).each(function(){this.complete&&a(this).load()})}catch(a){}},this.createVehicleGallery=function(){b.e('.chbs-main-content-step-2').on('click','.chbs-vehicle-list .chbs-vehicle-image img',function(c){c.preventDefault();var b=a(this).parents('.chbs-vehicle-image:first').nextAll('.chbs-vehicle-gallery');parseInt(b.length,10)===1&&a.fancybox.open(b.find('img'))})},this.googleMapStartCustomizeHeight=function(){if(parseInt(c.widget.mode,10)===1)return;if(parseInt(b.e('input[name="chbs_step"]').val(),10)!==1)return;if(j>0)return;j=window.setInterval(function(){b.googleMapCustomizeHeight()},500)},this.googleMapStopCustomizeHeight=function(){if(parseInt(c.widget.mode,10)===1)return;if(parseInt(b.e('input[name="chbs_step"]').val(),10)!==1)return;clearInterval(j),b.e('#chbs_google_map').height('420px'),j=0},this.googleMapCustomizeHeight=function(){var a,d,f;if(parseInt(c.widget.mode,10)===1)return;if(parseInt(b.e('input[name="chbs_step"]').val(),10)!==1)return;a=b.e('.chbs-ride-info'),d=b.e('.chbs-main-content-step-1>.chbs-layout-50x50>.chbs-layout-column-left'),f=new CHBSHelper,f.isMobile()?b.e('#chbs_google_map').height('420px'):b.e('#chbs_google_map').height(parseInt(d.actual('height'),10)-parseInt(a.actual('height'),10)),google.maps.event.trigger(e,'resize')},this.googleMapDuplicate=function(c){var a;c===4?(a=b.e('.chbs-google-map>#chbs_google_map'),a.children('div').length&&b.e('.chbs-google-map-summary').append(a)):(a=b.e('.chbs-google-map-summary>#chbs_google_map'),a.children('div').length&&b.e('.chbs-google-map').append(a)),google.maps.event.trigger(e,'resize');try{f.setDirections(m),f.setRouteIndex(b.getRouteIndex()),e.setCenter(f.getDirections().routes[b.getRouteIndex()].bounds.getCenter())}catch(a){}},this.googleMapSetAddress=function(c,d,f=!1){var e=new CHBSHelper,a,g;if(c.prop('tagName').toLowerCase()==='select'){d();return}if(a=JSON.parse(c.val()),e.isEmpty(a.lat)||e.isEmpty(a.lng))return;g=new google.maps.Geocoder,g.geocode({location:new google.maps.LatLng(a.lat,a.lng)},function(e,h){if(h==='OK'&&e[0]){if(a.address=b.removeDoubleQuote(e[0].formatted_address),f){var g=c.parent('.chbs-form-field-location-autocomplete').children('input[type="text"]');g.length===1&&g.val(a.address)}c.val(JSON.stringify(a)),d()}})},this.googleMapAutocompleteCreate=function(e){var i,d,f,h,g,j;if(e.is('[readonly]'))return;i='chbs_location_'+(new CHBSHelper).getRandomString(16),e.attr('id',i).on('keypress',function(a){if(a.which===13)return a.preventDefault(),!1}),e.on('change',function(){a.trim(a(this).val()).length||(e.siblings('input[type="hidden"]').val(''),b.googleMapCreate(),b.googleMapCreateRoute())}),d={},f=new CHBSHelper,h=new String(e.attr('name')),h.indexOf('pickup')>-1&&parseInt(c.driving_zone.pickup.enable)===1&&(!f.isEmpty(c.driving_zone.pickup.area.coordinate.lat)&&!f.isEmpty(c.driving_zone.pickup.area.coordinate.lat)&&parseInt(c.driving_zone.pickup.area.radius,10)>=0&&(g=new google.maps.Circle({center:new google.maps.LatLng(c.driving_zone.pickup.area.coordinate.lat,c.driving_zone.pickup.area.coordinate.lng),radius:c.driving_zone.pickup.area.radius*1e3}),d.strictBounds=!0,d.bounds=g.getBounds()),c.driving_zone.pickup.country.length&&a.inArray(-1,c.driving_zone.pickup.country)===-1&&(d.componentRestrictions={},d.componentRestrictions.country=c.driving_zone.pickup.country)),h.indexOf('waypoint')>-1&&parseInt(c.driving_zone.waypoint.enable)===1&&(!f.isEmpty(c.driving_zone.waypoint.area.coordinate.lat)&&!f.isEmpty(c.driving_zone.waypoint.area.coordinate.lat)&&parseInt(c.driving_zone.waypoint.area.radius,10)>=0&&(g=new google.maps.Circle({center:new google.maps.LatLng(c.driving_zone.waypoint.area.coordinate.lat,c.driving_zone.waypoint.area.coordinate.lng),radius:c.driving_zone.waypoint.area.radius*1e3}),d.strictBounds=!0,d.bounds=g.getBounds()),c.driving_zone.waypoint.country.length&&a.inArray(-1,c.driving_zone.waypoint.country)===-1&&(d.componentRestrictions={},d.componentRestrictions.country=c.driving_zone.waypoint.country)),h.indexOf('dropoff')>-1&&parseInt(c.driving_zone.dropoff.enable,10)===1&&(!f.isEmpty(c.driving_zone.dropoff.area.coordinate.lat)&&!f.isEmpty(c.driving_zone.dropoff.area.coordinate.lat)&&parseInt(c.driving_zone.dropoff.area.radius,10)>=0&&(g=new google.maps.Circle({center:new google.maps.LatLng(c.driving_zone.dropoff.area.coordinate.lat,c.driving_zone.dropoff.area.coordinate.lng),radius:c.driving_zone.dropoff.area.radius*1e3}),d.strictBounds=!0,d.bounds=g.getBounds()),c.driving_zone.dropoff.country.length&&a.inArray(-1,c.driving_zone.dropoff.country)===-1&&(d.componentRestrictions={},d.componentRestrictions.country=c.driving_zone.dropoff.country)),d.fields=['address_components','geometry'],j=new google.maps.places.Autocomplete(document.getElementById(i),d),j.addListener('place_changed',function(i){var d=j.getPlace(),f,g,h;if(!d.geometry)return alert(c.message.place_geometry_error),e.val(''),!1;f={lat:d.geometry.location.lat(),lng:d.geometry.location.lng(),address:b.removeDoubleQuote(e.val()),zip_code:b.getZipCode(d)};for(g in d.address_components)if(a.inArray('locality',d.address_components[g].types)>-1){f.locality=d.address_components[g].long_name;break}h=e.siblings('input[type="hidden"]'),h.val(JSON.stringify(f)),b.googleMapCreate(),b.googleMapCreateRoute()})},this.getZipCode=function(b){for(var a=0,c;a<b.address_components.length;a++)for(c=0;c<b.address_components[a].types.length;c++)if(b.address_components[a].types[c]=='postal_code')return b.address_components[a].long_name;return''},this.googleMapInit=function(){if(!b.googleMapExist())return;parseInt(c.google_map_option.default_location.type,10)===1?navigator.geolocation?(b.googleMapSetDefaultLocation(),navigator.geolocation.getCurrentPosition(function(a){try{g=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),e.setCenter(g)}catch(a){}},function(){b.googleMapSetDefaultLocation()})):b.googleMapSetDefaultLocation():b.googleMapSetDefaultLocation()},this.googleMapSetDefaultLocation=function(){var d,a;if(typeof g=='undefined'&&(g=new google.maps.LatLng(c.google_map_option.default_location.coordinate.lat,c.google_map_option.default_location.coordinate.lng)),b.getServiceTypeId()===3)return;d=new CHBSHelper,a=[],a[0]=b.e('[name="chbs_pickup_location_coordinate_service_type_'+b.getServiceTypeId()+'"]').val(),a[1]=b.e('[name="chbs_dropoff_location_coordinate_service_type_'+b.getServiceTypeId()+'"]').val(),!d.isEmpty(a[0])&&!d.isEmpty(a[1])&&(g=new google.maps.LatLng(a[0],a[1]));try{e.setCenter(g)}catch(a){}},this.googleMapCreate=function(){var d,g;if(b.e('#chbs_google_map').length!==1)return;f=new google.maps.DirectionsRenderer,l=new google.maps.DirectionsService,d={draggable:c.google_map_option.draggable.enable,scrollwheel:c.google_map_option.scrollwheel.enable,mapTypeId:google.maps.MapTypeId[c.google_map_option.map_control.id],mapTypeControl:c.google_map_option.map_control.enable,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle[c.google_map_option.map_control.style],position:google.maps.ControlPosition[c.google_map_option.map_control.position]},zoom:c.google_map_option.zoom_control.level,zoomControl:c.google_map_option.zoom_control.enable,zoomControlOptions:{position:google.maps.ControlPosition[c.google_map_option.zoom_control.position]},streetViewControl:!1},e=new google.maps.Map(b.e('#chbs_google_map')[0],d),parseInt(c.google_map_option.traffic_layer.enable,10)===1&&(g=new google.maps.TrafficLayer,g.setMap(e)),f.setMap(e),b.googleMapDraggableLocationAllowed()?f.setOptions({draggable:!0,suppressMarkers:!1}):f.setOptions({draggable:!1,suppressMarkers:!0}),b.googleMapDraggableLocationAllowed()&&(e.addListener('click',function(c){var a=new CHBSHelper,f=b.e('[name="chbs_pickup_location_service_type_'+b.getServiceTypeId()+'"]'),d=f.siblings('input[type="hidden"]'),g=b.e('[name="chbs_dropoff_location_service_type_'+b.getServiceTypeId()+'"]'),e=g.siblings('input[type="hidden"]'),h;if(!a.isEmpty(d.val())&&!a.isEmpty(e.val()))return;h=new google.maps.Geocoder,h.geocode({location:c.latLng},function(h,k){var i,j;k==='OK'&&h[0]&&(i=b.removeDoubleQuote(h[0].formatted_address),j={lat:c.latLng.lat(),lng:c.latLng.lng(),address:b.removeDoubleQuote(h[0].formatted_address)},a.isEmpty(d.val())?(f.val(i),d.val(JSON.stringify(j))):a.isEmpty(e.val())&&(g.val(i),e.val(JSON.stringify(j))),b.googleMapCreate(),b.googleMapCreateRoute())})}),f.addListener('directions_changed',function(){var r=new CHBSHelper,l=new google.maps.Geocoder,p=f.getDirections(),o=p.routes[b.getRouteIndex()],c=[],n,q,e,m,k,h,i,d,g,j;if(o.legs.forEach(function(a,b){parseInt(b,10)===0&&c.push({lat:a.start_location.lat(),lng:a.start_location.lng()}),a.via_waypoints.forEach(function(a,b){c.push({lat:a.lat(),lng:a.lng()})}),c.push({lat:a.end_location.lat(),lng:a.end_location.lng()})}),n=c.length,q=b.e('[name="chbs_waypoint_location_service_type_'+b.getServiceTypeId()+'[]"]'),e=[],e.push(b.e('[name="chbs_pickup_location_service_type_'+b.getServiceTypeId()+'"]')),b.e('[name="chbs_waypoint_location_service_type_'+b.getServiceTypeId()+'[]"]').each(function(b,c){b>0&&e.push(a(c))}),e.push(b.e('[name="chbs_dropoff_location_service_type_'+b.getServiceTypeId()+'"]')),m=e.length,n>m){for(h=1;h<n-1;h++)k=!1,q.each(function(e,f){var b,d;if(e>0)if(b=a(f).siblings('input[type="hidden"]').val(),!r.isEmpty(b))if(d=JSON.parse(b),d.lat==c[h].lat&&d.lng==c[h].lng)return k=!0,!1}),k||(i=h,l.geocode({location:new google.maps.LatLng(c[i].lat,c[i].lng)},function(a,g){var d,e,c,f;if(!(g==='OK'&&a[0]))return;d=b.removeDoubleQuote(a[0].formatted_address),e={lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng(),address:b.removeDoubleQuote(a[0].formatted_address)},b.e('.chbs-location-add').eq(i).trigger('click'),c=b.e('[name="chbs_waypoint_location_service_type_'+b.getServiceTypeId()+'[]"]').eq(i),f=c.siblings('input[type="hidden"]'),c.val(d),f.val(JSON.stringify(e)),b.googleMapCreate(),b.googleMapCreateRoute()}))}else d=!1,g=0,e.forEach(function(b,f){var e=new CHBSHelper,a=b.siblings('input[type="hidden"]').val(),h;e.isEmpty(a)&&m===2&&f===1&&!(c[0].lat==c[1].lat&&c[0].lng==c[1].lng)?(d=b,h={lat:c[1].lat,lng:c[1].lng},b.siblings('input[type="hidden"]').val(JSON.stringify(h))):e.isEmpty(a)||(a=JSON.parse(a),a.lat==c[g].lat&&a.lng==c[g].lng||(d=b,a.lat=c[g].lat,a.lng=c[g].lng,b.siblings('input[type="hidden"]').val(JSON.stringify(a))),g++)}),d!=!1&&(j=JSON.parse(d.siblings('input[type="hidden"]').val()),l.geocode({location:new google.maps.LatLng(j.lat,j.lng)},function(a,e){if(e==='OK'&&a[0]){var c=b.removeDoubleQuote(a[0].formatted_address);d.val(c),j.address=c,d.siblings('input[type="hidden"]').val(JSON.stringify(j))}}),b.googleMapCreate(),b.googleMapCreateRoute())}))},this.getCoordinate=function(j=!1){var d=new CHBSHelper,g=new Array,e=b.getServiceTypeId(),i=b.e('#panel-'+e).children('.chbs-form-field-location-autocomplete,.chbs-form-field-location-fixed'),h,c,f;if(e===1||e===2)i.each(function(){if(e===2&&a(this).hasClass('chbs-form-field-location-autocomplete')&&!j)if(a(this).children('input[name="chbs_dropoff_location_service_type_2"]').length===1)return!0;var b;try{a(this).hasClass('chbs-form-field-location-autocomplete')?b=JSON.parse(a(this).children('input[type="hidden"]').val()):a(this).find('input.chbs-form-field-location-fixed-autocomplete').length===0||a(this).find('input.chbs-form-field-location-fixed-autocomplete').val().length?b=JSON.parse(a(this).find('select>option:selected').attr('data-location')):b={lat:'',lng:''}}catch(a){b={lat:'',lng:''}}!d.isEmpty(b.lat)&&!d.isEmpty(b.lng)&&g.push(new google.maps.LatLng(b.lat,b.lng))});else if(h=b.e('select[name="chbs_route_service_type_3"]>option:selected'),h.length===1){c=JSON.parse(h.attr('data-coordinate'));for(f in c)!d.isEmpty(c[f].lat)&&!d.isEmpty(c[f].lng)&&g.push(new google.maps.LatLng(c[f].lat,c[f].lng))}return g},this.googleMapExist=function(){return typeof e!='undefined'},this.googleMapDraggableLocationAllowed=function(){var a=b.getServiceTypeId(),d=parseInt(b.e('#panel-'+a).children('.chbs-form-field-location-fixed').length,10);return d===0&&parseInt(c.google_map_option.draggable_location.enable,10)===1&&parseInt(b.getServiceTypeId(),10)===1&&b.e('[name="chbs_waypoint_location_service_type_'+b.getServiceTypeId()+'[]"]').length},this.googleMapCreateRoute=function(i){var j=b.getServiceTypeId(),h,o,d,g,n;if(!b.googleMapExist()){typeof i!='undefined'&&i();return}if(o=b.e('#panel-'+j).children('.chbs-form-field-location-autocomplete'),d=b.getCoordinate(),g=d.length,g===0){b.googleMapReInit(),typeof i!='undefined'&&i();return}j===2&&g===2&&(d=[d[0]],g=1),g>2?(n=new Array,d.forEach(function(b,a){a>0&&a<g-1&&n.push({location:b,stopover:!0})}),h={origin:d[0],waypoints:n,optimizeWaypoints:!1,destination:d[g-1],travelMode:google.maps.DirectionsTravelMode.DRIVING}):g===2?h={origin:d[0],destination:d[g-1],travelMode:google.maps.DirectionsTravelMode.DRIVING}:h={origin:d[g-1],destination:d[g-1],travelMode:google.maps.DirectionsTravelMode.DRIVING},h.avoidTolls=a.inArray('tolls',c.google_map_option.route_avoid)>-1,h.avoidFerries=a.inArray('ferries',c.google_map_option.route_avoid)>-1,h.avoidHighways=a.inArray('highways',c.google_map_option.route_avoid)>-1,parseInt(c.google_map_option.route_type,10)===2&&(h.provideRouteAlternatives=!0),l.route(h,function(d,u){var w,t,g,l,p,q,r,h,s,v,n;if(b.googleMapClearMarker(),u===google.maps.DirectionsStatus.OK){b.googleMapDraggableLocationAllowed()&&(w=new CHBSHelper,t=d.routes[b.getRouteIndex()],g=[],t.legs.forEach(function(a,b){b===0&&g.push({lat:a.start_location.lat(),lng:a.start_location.lng()}),a.via_waypoints.forEach(function(a,b){g.push({lat:a.lat(),lng:a.lng()})}),g.push({lat:a.end_location.lat(),lng:a.end_location.lng()})}),l=[],l.push(b.e('[name="chbs_pickup_location_service_type_'+b.getServiceTypeId()+'"]')),b.e('[name="chbs_waypoint_location_service_type_'+b.getServiceTypeId()+'[]"]').each(function(b,c){b>0&&l.push(a(c))}),l.push(b.e('[name="chbs_dropoff_location_service_type_'+b.getServiceTypeId()+'"]')),p=0,l.forEach(function(b,c){var a=b.siblings('input[type="hidden"]').val();w.isEmpty(a)||(a=JSON.parse(a),a.lat=g[p].lat,a.lng=g[p].lng,b.siblings('input[type="hidden"]').val(JSON.stringify(a)),p++)})),parseInt(c.google_map_option.route_type,10)===2&&(q=-1,d.routes.forEach(function(a,b){(a.legs[0].distance.value<q||q===-1)&&(q=a.legs[0].distance.value,k=b)})),f.setDirections(d),f.setRouteIndex(b.getRouteIndex()),m=d;for(r in d.routes[b.getRouteIndex()].legs)h=d.routes[b.getRouteIndex()].legs[r],b.googleMapCreateMarker(h.start_location),b.googleMapCreateMarker(h.end_location);if(parseInt(c.tax_rate_geofence_enable,10)===1){s=[];for(r in d.routes[b.getRouteIndex()].legs){h=d.routes[b.getRouteIndex()].legs[r];for(v in h.steps)n=h.steps[v],s.push([n.start_location,n.end_location,n.distance.value,n.lat_lngs])}b.e('input[name="chbs_route_data"]').val(JSON.stringify(s))}try{e.setCenter(f.getDirections().routes[b.getRouteIndex()].bounds.getCenter())}catch(a){}b.calculateRoute(d,i)}else u===google.maps.DirectionsStatus.ZERO_RESULTS&&j===1&&(alert(c.message.designate_route_error),o.each(function(){a(this).children('input[type="text"]').val(''),a(this).children('input[type="hidden"]').val('')}),b.googleMapReInit());typeof i!='undefined'&&i()})},this.googleMapClearMarker=function(){for(var a in h)h[a].setMap(null);h=[]},this.googleMapCreateMarker=function(c){var a,d,f;if(b.googleMapDraggableLocationAllowed())return;for(a in h){if(typeof h[a].position=='undefined')continue;if(h[a].position.lat()==c.lat()&&h[a].position.lng()==c.lng())return}d=h.length+1,f=new google.maps.Marker({position:c,map:e,label:''+d}),h.push(f)},this.googleMapReInit=function(){if(!b.googleMapExist())return;f=new google.maps.DirectionsRenderer,l=new google.maps.DirectionsService,m=null,f.setDirections({routes:[]}),e.setZoom(c.google_map_option.zoom_control.level),b.calculateRoute();try{g!==null&&e.setCenter(g)}catch(a){}},this.calculateRoute=function(d,g){var f=0,a=0,e;if(typeof d!='undefined'&&typeof d.routes!='undefined')for(e=0;e<d.routes[b.getRouteIndex()].legs.length;e++)f+=d.routes[b.getRouteIndex()].legs[e].distance.value,a+=d.routes[b.getRouteIndex()].legs[e].duration.value;f/=1e3,a=Math.ceil(a/60),c.ride_time_rounding>0&&(a=Math.ceil(a/c.ride_time_rounding)*c.ride_time_rounding),b.e('input[name="chbs_distance_map"]').val(Math.round(f*10)/10),b.e('input[name="chbs_duration_map"]').val(a*c.ride_time_multiplier),b.reCalculateRoute(g)},this.reCalculateRoute=function(l){var d=0,i=0,e=0,f=parseInt(b.e('input[name="chbs_service_type_id"]').val(),10),j,h,g,k;switch(e=b.e('input[name="chbs_distance_map"]').val(),f){case 1:j=new CHBSHelper,d=b.e('select[name="chbs_extra_time_service_type_1"]').val(),isNaN(d)&&(d=0),d*=c.extra_time_unit===2?60:1,b.e('input[name="chbs_waypoint_location_service_type_1[]"]').each(function(){var b={},c;try{b=JSON.parse(a(this).next('input').val())}catch(a){b.lat=null,b.lng=null}!j.isEmpty(b.lat)&&!j.isEmpty(b.lng)&&(c=a(this).parent('.chbs-form-field:first').next('.chbs-form-field-waypoint-duration').children('select'),parseInt(c.length,10)===1&&(i+=parseInt(c.val(),10)))});break;case 2:d=b.e('select[name="chbs_duration_service_type_2"]').val(),isNaN(d)&&(d=0),d*=60;break;case 3:d=b.e('select[name="chbs_extra_time_service_type_3"]').val(),isNaN(d)&&(d=0),d*=c.extra_time_unit===2?60:1;break}a.inArray(f,[1,3])>-1&&(h=b.e('select[name="chbs_transfer_type_service_type_'+f+'"]'),g=h.length===1?parseInt(h.val(),10)===1?1:2:1,d+=parseInt(b.e('input[name="chbs_duration_map"]').val(),10)*g+i*g,e*=g),b.e('input[name="chbs_distance_sum"]').val(e),b.e('input[name="chbs_duration_sum"]').val(d),k=b.splitTime(d),e=b.formatLength(e),b.e('.chbs-ride-info>div:eq(0)>span:eq(2)>span:eq(0)').html(e),b.e('.chbs-ride-info>div:eq(1)>span:eq(2)>span:eq(0)').html(k[0]),b.e('.chbs-ride-info>div:eq(1)>span:eq(2)>span:eq(2)').html(k[1]),b.calculateBaseLocationDistance(l)},this.formatLength=function(a){return c.length_unit===2&&(a/=1.609344,a=Math.round(a*10)/10),a},this.splitTime=function(a){return[Math.floor(a/60),a%60]},this.setWidthClass=function(){var f,e,g,h;if(parseInt(c.widget.mode,10)===1)if(d.hasClass('chbs-widget-style-1'))return;f=d.parent().width(),e=null,g='chbs-width-',f>=1220?e='1220':f>=960?e='960':f>=768?e='768':f>=480?e='480':f>=300?e='300':e='300',h=b.getValueFromClass(d,g),h!==!1&&d.removeClass(g+h),d.addClass(g+e),b.prevWidth!==f&&(b.prevWidth=f,a(window).resize(),b.createStickySidebar(),parseInt(c.widget.mode,10)!==1&&(a.inArray(e,['300','480'])>-1?b.googleMapStopCustomizeHeight():b.googleMapStartCustomizeHeight())),setTimeout(b.setWidthClass,500)},this.getValueFromClass=function(f,d){var e,b,c;try{e=new RegExp(d),b=a(f).attr('class').split(' ');for(c in b)if(e.test(b[c]))return b[c].substring(d.length)}catch(a){}return!1},this.createSummaryPriceElement=function(){b.setAction('create_summary_price_element'),b.post(b.e('form[name="chbs-form"]').serialize(),function(c){b.e('.chbs-summary-price-element').replaceWith(c.html),a(window).scroll()})},this.createStickySidebar=function(){var e,f;if(parseInt(c.summary_sidebar_sticky_enable,10)!==1)return;if(e=b.getValueFromClass(d,'chbs-width-'),a.inArray(e,['300','480','768'])>-1){b.removeStickySidebar();return}if(d.hasClass('chbs-hidden'))return;f=parseInt(b.e('input[name="chbs_step"]').val(),10),n=b.e('.chbs-main-content>.chbs-main-content-step-'+f+'>.chbs-layout-25x75 .chbs-layout-column-left:first').theiaStickySidebar({additionalMarginTop:40,additionalMarginBottom:40})},this.removeStickySidebar=function(){if(parseInt(c.summarySidebarStickyEnable,10)!==1)return;try{n.destroy()}catch(a){}},this.getGlobalNotice=function(){var a=parseInt(b.e('input[name="chbs_step"]').val(),10);return b.e('.chbs-main-content-step-'+a+' .chbs-notice')},this.calculateBaseLocationDistance=function(i,f){var k,e,d,m,h,j,g,l;return typeof f=='undefined'&&(f=!1),k=new CHBSHelper,d={distance:0,duration:0,return_distance:0,return_duration:0},f===!1?(b.e('input[name="chbs_base_location_distance"]').val(0),b.e('input[name="chbs_base_location_duration"]').val(0),b.e('input[name="chbs_base_location_return_distance"]').val(0),b.e('input[name="chbs_base_location_return_duration"]').val(0),e={coordinate:{lat:c.base_location.coordinate.lat,lng:c.base_location.coordinate.lng}},m=b.e('input[name="chbs_vehicle_id"]').val(),h=b.e('.chbs-vehicle-list .chbs-vehicle[data-id="'+m+'"]'),h.length===1&&!k.isEmpty(h.attr('data-base_location_cooridnate_lat'))&&!k.isEmpty(h.attr('data-base_location_cooridnate_lng'))&&(e.coordinate.lat=h.attr('data-base_location_cooridnate_lat'),e.coordinate.lng=h.attr('data-base_location_cooridnate_lng'))):(d.id=f.id,e={coordinate:{lat:f.lat,lng:f.lng}}),k.isEmpty(e.coordinate.lat)||k.isEmpty(e.coordinate.lng)?(b.callback(i,d),d):(g=b.getCoordinate(!0),l=new google.maps.DirectionsService,parseInt(g.length,10)===0)?(b.callback(i,d),d):(j={origin:g[0],optimizeWaypoints:!1,destination:new google.maps.LatLng(e.coordinate.lat,e.coordinate.lng),travelMode:google.maps.DirectionsTravelMode.DRIVING},l.route(j,function(m,q){var c,h,k,o,p,n;if(q===google.maps.DirectionsStatus.OK){c=0,h=0;for(k=0;k<m.routes[0].legs.length;k++)c+=m.routes[0].legs[k].distance.value,h+=m.routes[0].legs[k].duration.value;c/=1e3,c=Math.round(c*10)/10,h=Math.ceil(h/60),f===!1?(b.e('input[name="chbs_base_location_distance"]').val(c),b.e('input[name="chbs_base_location_duration"]').val(h)):(d.distance=c,d.duration=h),g.length>1?(o=1,p=b.getServiceTypeId(),a.inArray(p,[1,3])>-1&&(n=b.e('select[name="chbs_transfer_type_service_type_'+p+'"]'),o=n.length===1?parseInt(n.val(),10):1),j={optimizeWaypoints:!1,origin:a.inArray(o,[1,3])>-1?g[g.length-1]:g[0],destination:new google.maps.LatLng(e.coordinate.lat,e.coordinate.lng),travelMode:google.maps.DirectionsTravelMode.DRIVING},l.route(j,function(g,h){var a,c,e;if(h===google.maps.DirectionsStatus.OK){a=0,c=0;for(e=0;e<g.routes[0].legs.length;e++)a+=g.routes[0].legs[e].distance.value,c+=g.routes[0].legs[e].duration.value;a/=1e3,a=Math.round(a*10)/10,c=Math.ceil(c/60),f===!1?(b.e('input[name="chbs_base_location_return_distance"]').val(a),b.e('input[name="chbs_base_location_return_duration"]').val(c)):(d.return_distance=a,d.return_duration=c)}b.callback(i,d)})):b.callback(i,d)}else b.callback(i,d)}),d)},this.getRouteIndex=function(){return isNaN(k)?0:k},this.removeDoubleQuote=function(a){return a.replace(/"/g,'')},this.callback=function(a,b){typeof a!='undefined'&&a(b)},this.createButtonRadio=function(c){b.e(c).on('click','.chbs-button-radio a',function(c){c.preventDefault();var b=a(this).parent('.chbs-button-radio').find('input[type="hidden"]');a(this).siblings('a').removeClass('chbs-state-selected'),a(this).hasClass('chbs-state-selected')?(b.val(-1),a(this).removeClass('chbs-state-selected')):(b.val(a(this).attr('data-value')),a(this).addClass('chbs-state-selected'))})}};a.fn.chauffeurBookingForm=function(a){console.log('--------------------------------------------------------------------------------------------'),console.log('Chauffer Booking System for WordPress ver. '+a.plugin_version),console.log('https://1.envato.market/chauffeur-booking-system-for-wordpress-preview'),console.log('--------------------------------------------------------------------------------------------');var c=new b(this,a);return c}})(jQuery,document,window)