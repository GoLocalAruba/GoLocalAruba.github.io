(function(e){"use strict";var s=function(t,n){var a=this,c=n,l=e("#respond"),s=e("#comments"),o=e("#comment-form"),d=e("#comment_post_ID"),r=e("#comment_parent"),i=e("#cancel-comment-reply-link");this.build=function(){var t=this;l.addClass("theme-clear-fix"),o.find(">.form-submit").append(i),o.find('>.form-submit>input[type="submit"]').addClass("theme-component-button theme-component-button-style-1"),i.wrap('<div class="theme-component-button theme-component-button-style-2"></div>'),o.submit(function(){return t.addComment(),!1}),this.bindEvent(),e(window).on("hashchange",function(){if(location.hash.substr(1,6)==="cpage-"){var n={};if(n.cpage=parseInt(location.hash.substr(7),10),n.comment_form_post_id=parseInt(d.val(),10),n.cpage===s.data("cpage"))return;n.action="comment_get",e("#comments").css("opacity","0.5"),jQuery.ajax({url:c.requestURL,data:n,type:"GET",success:t.getCommentResponse,dataType:"json",contextObject:t})}}),e(window).trigger("hashchange")},this.getCommentResponse=function(t){s.html(t.html),s.data("cpage",t.cpage),this.contextObject.bindEvent(),e.scrollTo(s,400,{easing:"easeOutQuint",offset:a.getScrollOffset()}),e("#comments").css("opacity","1.0")},this.bindEvent=function(){var t=document.ontouchstart!==null?"click":"touchstart";e(".theme-comment-meta-reply-button").bind(t,function(t){t.preventDefault(),i.css("display","block"),r.val(jQuery(this).attr("href").substr(9)),e.scrollTo(l,400,{easing:"easeOutQuint",offset:a.getScrollOffset()})}),i.bind(t,function(t){t.preventDefault(),r.val(0),e(this).css("display","none"),e.scrollTo(s,400,{easing:"easeOutQuint",offset:a.getScrollOffset()})}),s.find(">#comments_list>.theme-pagination>a").each(function(){e(this).attr("href",e(this).attr("href").substr(e(this).attr("href").indexOf("#")))})},this.addComment=function(){var t=o.serialize()+"&cpage="+s.data("cpage")+"&action=comment_add";this.blockForm("block"),e.ajax({url:c.requestURL,data:t,type:"POST",success:this.addCommentResponse,dataType:"json",contextObject:this})},this.addCommentResponse=function(t){if(this.contextObject.blockForm("unblock"),parseInt(t.error)===0&&(s.html(t.html),s.data("cpage",t.cpage)),o.find("label").qtip("destroy"),typeof t.info!="undefined"&&t.info.length)for(var n in t.info)e("#"+t.info[n].fieldId).parent("div").children("label").qtip({style:{classes:parseInt(t.error,10)===1?"theme-qtip theme-qtip-error":"theme-qtip theme-qtip-success"},content:{text:t.info[n].message},position:{my:"left center",at:"right center"}}).qtip("show");parseInt(t.error,10)===0&&(r.val(0),i.css("display","none"),e.scrollTo("#comment-"+t.commentId,400,{easing:"easeOutQuint",offset:a.getScrollOffset()}),e("#author,#email,#url,#comment").val("").blur(),this.contextObject.bindEvent(),t.changeURL.length!==0&&(location.href=t.changeURL))},this.blockForm=function(t){t==="block"?(o=e("#comment-form"),o.block({message:!1,overlayCSS:{backgroundColor:"#FFFFFF",opacity:"0.2",cursor:"not-allowed"}})):o.unblock()},this.getScrollOffset=function(){var t=-20,n=e("#wpadminbar");return n.length===1&&(t-=n.actual("height")),t}};e.fn.ThemeComment=function(e){var t=new s(this,e);t.build()}})(jQuery,document,window)