(function(a,c,d){"use strict";var b=function(k,i){var e=this,h=i,g=a('#respond'),b=a('#comments'),c=a('#comment-form'),j=a('#comment_post_ID'),f=a('#comment_parent'),d=a('#cancel-comment-reply-link');this.build=function(){var e=this;g.addClass('theme-clear-fix'),c.find('>.form-submit').append(d),c.find('>.form-submit>input[type="submit"]').addClass('theme-component-button theme-component-button-style-1'),d.wrap('<div class="theme-component-button theme-component-button-style-2"></div>'),c.submit(function(){return e.addComment(),!1}),this.bindEvent(),a(window).on('hashchange',function(){if(location.hash.substr(1,6)==='cpage-'){var c={};if(c.cpage=parseInt(location.hash.substr(7),10),c.comment_form_post_id=parseInt(j.val(),10),c.cpage===b.data('cpage'))return;c.action='comment_get',a('#comments').css('opacity','0.5'),jQuery.ajax({url:h.requestURL,data:c,type:'GET',success:e.getCommentResponse,dataType:'json',contextObject:e})}}),a(window).trigger('hashchange')},this.getCommentResponse=function(c){b.html(c.html),b.data('cpage',c.cpage),this.contextObject.bindEvent(),a.scrollTo(b,400,{easing:'easeOutQuint',offset:e.getScrollOffset()}),a('#comments').css('opacity','1.0')},this.bindEvent=function(){var c=document.ontouchstart!==null?'click':'touchstart';a('.theme-comment-meta-reply-button').bind(c,function(b){b.preventDefault(),d.css('display','block'),f.val(jQuery(this).attr('href').substr(9)),a.scrollTo(g,400,{easing:'easeOutQuint',offset:e.getScrollOffset()})}),d.bind(c,function(c){c.preventDefault(),f.val(0),a(this).css('display','none'),a.scrollTo(b,400,{easing:'easeOutQuint',offset:e.getScrollOffset()})}),b.find('>#comments_list>.theme-pagination>a').each(function(){a(this).attr('href',a(this).attr('href').substr(a(this).attr('href').indexOf('#')))})},this.addComment=function(){var d=c.serialize()+'&cpage='+b.data('cpage')+'&action=comment_add';this.blockForm('block'),a.ajax({url:h.requestURL,data:d,type:'POST',success:this.addCommentResponse,dataType:'json',contextObject:this})},this.addCommentResponse=function(g){if(this.contextObject.blockForm('unblock'),parseInt(g.error)===0&&(b.html(g.html),b.data('cpage',g.cpage)),c.find('label').qtip('destroy'),typeof g.info!='undefined')if(g.info.length)for(var h in g.info)a('#'+g.info[h].fieldId).parent('div').children('label').qtip({style:{classes:parseInt(g.error,10)===1?'theme-qtip theme-qtip-error':'theme-qtip theme-qtip-success'},content:{text:g.info[h].message},position:{my:'left center',at:'right center'}}).qtip('show');parseInt(g.error,10)===0&&(f.val(0),d.css('display','none'),a.scrollTo('#comment-'+g.commentId,400,{easing:'easeOutQuint',offset:e.getScrollOffset()}),a('#author,#email,#url,#comment').val('').blur(),this.contextObject.bindEvent(),g.changeURL.length!==0&&(location.href=g.changeURL))},this.blockForm=function(b){b==='block'?(c=a('#comment-form'),c.block({message:!1,overlayCSS:{backgroundColor:'#FFFFFF',opacity:'0.2',cursor:'not-allowed'}})):c.unblock()},this.getScrollOffset=function(){var b=-20,c=a('#wpadminbar');return c.length===1&&(b-=c.actual('height')),b}};a.fn.ThemeComment=function(a){var c=new b(this,a);c.build()}})(jQuery,document,window)