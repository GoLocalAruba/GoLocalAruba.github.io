(function(a){'use strict';typeof define=='function'&&define.amd?define(['jquery','jquery-ui/ui/widget'],a):typeof exports=='object'?a(require('jquery'),require('./vendor/jquery.ui.widget')):a(window.jQuery)})(function(a){'use strict';a.support.fileInput=!(new RegExp('(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))').test(window.navigator.userAgent)||a('<input type="file"/>').prop('disabled')),a.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader),a.support.xhrFormDataFileUpload=!!window.FormData,a.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);function b(b){var c=b==='dragover';return function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;var e=d.dataTransfer;e&&a.inArray('Files',e.types)!==-1&&this._trigger(b,a.Event(b,{delegatedEvent:d}))!==!1&&(d.preventDefault(),c&&(e.dropEffect='copy'))}}a.widget('blueimp.fileupload',{options:{dropZone:a(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,uniqueFilenames:void 0,messages:{uploadedBytes:'Uploaded bytes exceed file size'},i18n:function(b,c){return b=this.messages[b]||b.toString(),c&&a.each(c,function(a,c){b=b.replace('{'+a+'}',c)}),b},formData:function(a){return a.serializeArray()},add:function(c,b){if(c.isDefaultPrevented())return!1;(b.autoUpload||b.autoUpload!==!1&&a(this).fileupload('option','autoUpload'))&&b.process().done(function(){b.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:['fileInput','dropZone','pasteZone','multipart','forceIframeTransport'],_blobSlice:a.support.blobSlice&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(a,b,c){var d=a-this.timestamp;return(!this.bitrate||!c||d>c)&&(this.bitrate=(b-this.loaded)*(1e3/d)*8,this.loaded=b,this.timestamp=a),this.bitrate}},_isXHRUpload:function(b){return!b.forceIframeTransport&&(!b.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(b){var c;return a.type(b.formData)==='function'?b.formData(b.form):a.isArray(b.formData)?b.formData:a.type(b.formData)==='object'?(c=[],a.each(b.formData,function(a,b){c.push({name:a,value:b})}),c):[]},_getTotal:function(c){var b=0;return a.each(c,function(c,a){b+=a.size||1}),b},_initProgressObject:function(b){var c={loaded:0,total:0,bitrate:0};b._progress?a.extend(b._progress,c):b._progress=c},_initResponseObject:function(a){var b;if(a._response){for(b in a._response)Object.prototype.hasOwnProperty.call(a._response,b)&&delete a._response[b]}else a._response={}},_onProgress:function(c,b){if(c.lengthComputable){var d=Date.now?Date.now():(new Date).getTime(),e;if(b._time&&b.progressInterval&&d-b._time<b.progressInterval&&c.loaded!==c.total)return;b._time=d,e=Math.floor(c.loaded/c.total*(b.chunkSize||b._progress.total))+(b.uploadedBytes||0),this._progress.loaded+=e-b._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(d,this._progress.loaded,b.bitrateInterval),b._progress.loaded=b.loaded=e,b._progress.bitrate=b.bitrate=b._bitrateTimer.getBitrate(d,e,b.bitrateInterval),this._trigger('progress',a.Event('progress',{delegatedEvent:c}),b),this._trigger('progressall',a.Event('progressall',{delegatedEvent:c}),this._progress)}},_initProgressListener:function(b){var d=this,c=b.xhr?b.xhr():a.ajaxSettings.xhr();c.upload&&(a(c.upload).bind('progress',function(a){var c=a.originalEvent;a.lengthComputable=c.lengthComputable,a.loaded=c.loaded,a.total=c.total,d._onProgress(a,b)}),b.xhr=function(){return c})},_deinitProgressListener:function(b){var c=b.xhr?b.xhr():a.ajaxSettings.xhr();c.upload&&a(c.upload).unbind('progress')},_isInstanceOf:function(a,b){return Object.prototype.toString.call(b)==='[object '+a+']'},_getUniqueFilename:function(a,b){return a=String(a),b[a]?(a=a.replace(/(?: \(([\d]+)\))?(\.[^.]+)?$/,function(e,a,b){var c=a?Number(a)+1:1,d=b||'';return' ('+c+')'+d}),this._getUniqueFilename(a,b)):(b[a]=!0,a)},_initXHRData:function(b){var e=this,c,d=b.files[0],g=b.multipart||!a.support.xhrFileUpload,f=a.type(b.paramName)==='array'?b.paramName[0]:b.paramName;b.headers=a.extend({},b.headers),b.contentRange&&(b.headers['Content-Range']=b.contentRange),(!g||b.blob||!this._isInstanceOf('File',d))&&(b.headers['Content-Disposition']='attachment; filename="'+encodeURI(d.uploadName||d.name)+'"'),g?a.support.xhrFormDataFileUpload&&(b.postMessage?(c=this._getFormData(b),b.blob?c.push({name:f,value:b.blob}):a.each(b.files,function(d,e){c.push({name:a.type(b.paramName)==='array'&&b.paramName[d]||f,value:e})})):(e._isInstanceOf('FormData',b.formData)?c=b.formData:(c=new FormData,a.each(this._getFormData(b),function(b,a){c.append(a.name,a.value)})),b.blob?c.append(f,b.blob,d.uploadName||d.name):a.each(b.files,function(h,d){if(e._isInstanceOf('File',d)||e._isInstanceOf('Blob',d)){var g=d.uploadName||d.name;b.uniqueFilenames&&(g=e._getUniqueFilename(g,b.uniqueFilenames)),c.append(a.type(b.paramName)==='array'&&b.paramName[h]||f,d,g)}})),b.data=c):(b.contentType=d.type||'application/octet-stream',b.data=b.blob||d),b.blob=null},_initIframeSettings:function(b){var c=a('<a></a>').prop('href',b.url).prop('host');b.dataType='iframe '+(b.dataType||''),b.formData=this._getFormData(b),b.redirect&&c&&c!==location.host&&b.formData.push({name:b.redirectParamName||'redirect',value:b.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType='postmessage '+(a.dataType||''))):this._initIframeSettings(a)},_getParamName:function(c){var d=a(c.fileInput),b=c.paramName;return b?a.isArray(b)||(b=[b]):(b=[],d.each(function(){for(var c=a(this),e=c.prop('name')||'files[]',d=(c.prop('files')||[1]).length;d;)b.push(e),d-=1}),b.length||(b=[d.prop('name')||'files[]'])),b},_initFormSettings:function(b){(!b.form||!b.form.length)&&(b.form=a(b.fileInput.prop('form')),b.form.length||(b.form=a(this.options.fileInput.prop('form')))),b.paramName=this._getParamName(b),b.url||(b.url=b.form.prop('action')||location.href),b.type=(b.type||a.type(b.form.prop('method'))==='string'&&b.form.prop('method')||'').toUpperCase(),b.type!=='POST'&&b.type!=='PUT'&&b.type!=='PATCH'&&(b.type='POST'),b.formAcceptCharset||(b.formAcceptCharset=b.form.attr('accept-charset'))},_getAJAXSettings:function(c){var b=a.extend({},this.options,c);return this._initFormSettings(b),this._initDataSettings(b),b},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?'resolved':a.isRejected()?'rejected':'pending'},_enhancePromise:function(a){return a.success=a.done,a.error=a.fail,a.complete=a.always,a},_getXHRPromise:function(e,b,f){var c=a.Deferred(),d=c.promise();return b=b||this.options.context||d,e===!0?c.resolveWith(b,f):e===!1&&c.rejectWith(b,f),d.abort=c.promise,this._enhancePromise(d)},_addConvenienceMethods:function(e,b){var c=this,d=function(b){return a.Deferred().resolveWith(c,b).promise()};b.process=function(e,f){return(e||f)&&(b._processQueue=this._processQueue=(this._processQueue||d([this])).then(function(){return b.errorThrown?a.Deferred().rejectWith(c,[b]).promise():d(arguments)}).then(e,f)),this._processQueue||d([this])},b.submit=function(){return this.state()!=='pending'&&(b.jqXHR=this.jqXHR=c._trigger('submit',a.Event('submit',{delegatedEvent:e}),this)!==!1&&c._onSend(e,this)),this.jqXHR||c._getXHRPromise()},b.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown='abort',c._trigger('fail',null,this),c._getXHRPromise(!1))},b.state=function(){if(this.jqXHR)return c._getDeferredState(this.jqXHR);if(this._processQueue)return c._getDeferredState(this._processQueue)},b.processing=function(){return!this.jqXHR&&this._processQueue&&c._getDeferredState(this._processQueue)==='pending'},b.progress=function(){return this._progress},b.response=function(){return this._response}},_getUploadedBytes:function(d){var b=d.getResponseHeader('Range'),a=b&&b.split('-'),c=a&&a.length>1&&parseInt(a[1],10);return c&&c+1},_chunkedUpload:function(b,m){b.uploadedBytes=b.uploadedBytes||0;var c=this,f=b.files[0],g=f.size,d=b.uploadedBytes,e=b.maxChunkSize||g,k=this._blobSlice,h=a.Deferred(),i=h.promise(),l,j;return!(!(this._isXHRUpload(b)&&k&&(d||(a.type(e)==='function'?e(b):e)<g))||b.data)&&(!!m||(d>=g?(f.error=b.i18n('uploadedBytes'),this._getXHRPromise(!1,b.context,[null,'error',f.error])):(j=function(){var i=a.extend({},b),m=i._progress.loaded;i.blob=k.call(f,d,d+(a.type(e)==='function'?e(i):e),f.type),i.chunkSize=i.blob.size,i.contentRange='bytes '+d+'-'+(d+i.chunkSize-1)+'/'+g,c._trigger('chunkbeforesend',null,i),c._initXHRData(i),c._initProgressListener(i),l=(c._trigger('chunksend',null,i)!==!1&&a.ajax(i)||c._getXHRPromise(!1,i.context)).done(function(f,k,e){d=c._getUploadedBytes(e)||d+i.chunkSize,m+i.chunkSize-i._progress.loaded&&c._onProgress(a.Event('progress',{lengthComputable:!0,loaded:d-i.uploadedBytes,total:d-i.uploadedBytes}),i),b.uploadedBytes=i.uploadedBytes=d,i.result=f,i.textStatus=k,i.jqXHR=e,c._trigger('chunkdone',null,i),c._trigger('chunkalways',null,i),d<g?j():h.resolveWith(i.context,[f,k,e])}).fail(function(a,b,d){i.jqXHR=a,i.textStatus=b,i.errorThrown=d,c._trigger('chunkfail',null,i),c._trigger('chunkalways',null,i),h.rejectWith(i.context,[a,b,d])}).always(function(){c._deinitProgressListener(i)})},this._enhancePromise(i),i.abort=function(){return l.abort()},j(),i)))},_beforeSend:function(b,a){this._active===0&&(this._trigger('start'),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(a),this._initProgressObject(a),a._progress.loaded=a.loaded=a.uploadedBytes||0,a._progress.total=a.total=this._getTotal(a.files)||1,a._progress.bitrate=a.bitrate=0,this._active+=1,this._progress.loaded+=a.loaded,this._progress.total+=a.total},_onDone:function(e,f,g,b){var c=b._progress.total,d=b._response;b._progress.loaded<c&&this._onProgress(a.Event('progress',{lengthComputable:!0,loaded:c,total:c}),b),d.result=b.result=e,d.textStatus=b.textStatus=f,d.jqXHR=b.jqXHR=g,this._trigger('done',null,b)},_onFail:function(c,d,e,a){var b=a._response;a.recalculateProgress&&(this._progress.loaded-=a._progress.loaded,this._progress.total-=a._progress.total),b.jqXHR=a.jqXHR=c,b.textStatus=a.textStatus=d,b.errorThrown=a.errorThrown=e,this._trigger('fail',null,a)},_onAlways:function(b,c,d,a){this._trigger('always',null,a)},_onSend:function(i,j){j.submit||this._addConvenienceMethods(i,j);var b=this,d,h,e,g,c=b._getAJAXSettings(j),f=function(){return b._sending+=1,c._bitrateTimer=new b._BitrateTimer,d=d||((h||b._trigger('send',a.Event('send',{delegatedEvent:i}),c)===!1)&&b._getXHRPromise(!1,c.context,h)||b._chunkedUpload(c)||a.ajax(c)).done(function(a,d,e){b._onDone(a,d,e,c)}).fail(function(a,d,e){b._onFail(a,d,e,c)}).always(function(d,e,f){if(b._deinitProgressListener(c),b._onAlways(d,e,f,c),b._sending-=1,b._active-=1,c.limitConcurrentUploads&&c.limitConcurrentUploads>b._sending)for(var a=b._slots.shift();a;){if(b._getDeferredState(a)==='pending'){a.resolve();break}a=b._slots.shift()}b._active===0&&b._trigger('stop')}),d};return this._beforeSend(i,c),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(e=a.Deferred(),this._slots.push(e),g=e.then(f)):(this._sequence=this._sequence.then(f,f),g=this._sequence),g.abort=function(){return h=[void 0,'abort','abort'],!d?(e&&e.rejectWith(c.context,h),f()):d.abort()},this._enhancePromise(g)):f()},_onAdd:function(r,n){var m=this,p=!0,e=a.extend({},this.options,n),c=n.files,l=c.length,h=e.limitMultiFileUploads,j=e.limitMultiFileUploadSize,q=e.limitMultiFileUploadSizeOverhead,o=0,i=this._getParamName(e),f,d,g,b,k=0;if(!l)return!1;if(j&&c[0].size===void 0&&(j=void 0),!(e.singleFileUploads||h||j)||!this._isXHRUpload(e))g=[c],f=[i];else if(!(e.singleFileUploads||j)&&h){g=[],f=[];for(b=0;b<l;b+=h)g.push(c.slice(b,b+h)),d=i.slice(b,b+h),d.length||(d=i),f.push(d)}else if(!e.singleFileUploads&&j){{g=[],f=[];for(b=0;b<l;b=b+1)o+=c[b].size+q,(b+1===l||o+c[b+1].size+q>j||h&&b+1-k>=h)&&(g.push(c.slice(k,b+1)),d=i.slice(k,b+1),d.length||(d=i),f.push(d),k=b+1,o=0)}}else f=i;return n.originalFiles=c,a.each(g||c,function(d,c){var b=a.extend({},n);return b.files=g?c:[c],b.paramName=f[d],m._initResponseObject(b),m._initProgressObject(b),m._addConvenienceMethods(r,b),p=m._trigger('add',a.Event('add',{delegatedEvent:r}),b),p}),p},_replaceFileInput:function(d){var b=d.fileInput,c=b.clone(!0),e=b.is(document.activeElement);d.fileInputClone=c,a('<form></form>').append(c)[0].reset(),b.after(c).detach(),e&&c.focus(),a.cleanData(b.unbind('remove')),this.options.fileInput=this.options.fileInput.map(function(d,a){return a===b[0]?c[0]:a}),b[0]===this.element[0]&&(this.element=c)},_handleFileTreeEntry:function(b,d){var j=this,c=a.Deferred(),e=[],h,f=function(a){a&&!a.entry&&(a.entry=b),c.resolve([a])},i=function(a){j._handleFileTreeEntries(a,d+b.name+'/').done(function(a){c.resolve(a)}).fail(f)},g=function(){h.readEntries(function(a){a.length?(e=e.concat(a),g()):i(e)},f)};return d=d||'',b.isFile?b._file?(b._file.relativePath=d,c.resolve(b._file)):b.file(function(a){a.relativePath=d,c.resolve(a)},f):b.isDirectory?(h=b.createReader(),g()):c.resolve([]),c.promise()},_handleFileTreeEntries:function(b,c){var d=this;return a.when.apply(a,a.map(b,function(a){return d._handleFileTreeEntry(a,c)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(c){c=c||{};var b=c.items;return b&&b.length&&(b[0].webkitGetAsEntry||b[0].getAsEntry)?this._handleFileTreeEntries(a.map(b,function(a){var b;return a.webkitGetAsEntry?(b=a.webkitGetAsEntry(),b&&(b._file=a.getAsFile()),b):a.getAsEntry()})):a.Deferred().resolve(a.makeArray(c.files)).promise()},_getSingleFileInputFiles:function(c){c=a(c);var d=c.prop('webkitEntries')||c.prop('entries'),b,e;if(d&&d.length)return this._handleFileTreeEntries(d);if(b=a.makeArray(c.prop('files')),b.length)b[0].name===void 0&&b[0].fileName&&a.each(b,function(b,a){a.name=a.fileName,a.size=a.fileSize});else{if(e=c.prop('value'),!e)return a.Deferred().resolve([]).promise();b=[{name:e.replace(/^.*\\/,'')}]}return a.Deferred().resolve(b).promise()},_getFileInputFiles:function(b){return!(b instanceof a)||b.length===1?this._getSingleFileInputFiles(b):a.when.apply(a,a.map(b,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(c){var d=this,b={fileInput:a(c.target),form:a(c.target.form)};this._getFileInputFiles(b.fileInput).always(function(e){b.files=e,d.options.replaceFileInput&&d._replaceFileInput(b),d._trigger('change',a.Event('change',{delegatedEvent:c}),b)!==!1&&d._onAdd(c,b)})},_onPaste:function(b){var c=b.originalEvent&&b.originalEvent.clipboardData&&b.originalEvent.clipboardData.items,d={files:[]};c&&c.length&&(a.each(c,function(c,a){var b=a.getAsFile&&a.getAsFile();b&&d.files.push(b)}),this._trigger('paste',a.Event('paste',{delegatedEvent:b}),d)!==!1&&this._onAdd(b,d))},_onDrop:function(b){b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var e=this,c=b.dataTransfer,d={};c&&c.files&&c.files.length&&(b.preventDefault(),this._getDroppedFiles(c).always(function(c){d.files=c,e._trigger('drop',a.Event('drop',{delegatedEvent:b}),d)!==!1&&e._onAdd(b,d)}))},_onDragOver:b('dragover'),_onDragEnter:b('dragenter'),_onDragLeave:b('dragleave'),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),a.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,'dragenter dragleave dragover drop'),this._off(this.options.pasteZone,'paste'),this._off(this.options.fileInput,'change')},_destroy:function(){this._destroyEventHandlers()},_setOption:function(b,d){var c=a.inArray(b,this._specialOptions)!==-1;c&&this._destroyEventHandlers(),this._super(b,d),c&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var b=this.options;b.fileInput===void 0?b.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):b.fileInput instanceof a||(b.fileInput=a(b.fileInput)),b.dropZone instanceof a||(b.dropZone=a(b.dropZone)),b.pasteZone instanceof a||(b.pasteZone=a(b.pasteZone))},_getRegExp:function(b){var a=b.split('/'),c=a.pop();return a.shift(),new RegExp(a.join('/'),c)},_isRegExpOption:function(c,b){return c!=='url'&&a.type(b)==='string'&&/^\/.*\/[igm]{0,3}$/.test(b)},_initDataAttributes:function(){var b=this,c=this.options,d=this.element.data();a.each(this.element[0].attributes,function(g,f){var a=f.name.toLowerCase(),e;/^data-/.test(a)&&(a=a.slice(5).replace(/-[a-z]/g,function(a){return a.charAt(1).toUpperCase()}),e=d[a],b._isRegExpOption(a,e)&&(e=b._getRegExp(e)),c[a]=e)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(b){var c=this;if(!b||this.options.disabled)return;b.fileInput&&!b.files?this._getFileInputFiles(b.fileInput).always(function(a){b.files=a,c._onAdd(null,b)}):(b.files=a.makeArray(b.files),this._onAdd(null,b))},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var g=this,c=a.Deferred(),e=c.promise(),d,f;return e.abort=function(){return f=!0,d?d.abort():(c.reject(null,'abort','abort'),e)},this._getFileInputFiles(b.fileInput).always(function(a){if(f)return;if(!a.length){c.reject();return}b.files=a,d=g._onSend(null,b),d.then(function(a,b,d){c.resolve(a,b,d)},function(a,b,d){c.reject(a,b,d)})}),this._enhancePromise(e)}if(b.files=a.makeArray(b.files),b.files.length)return this._onSend(null,b)}return this._getXHRPromise(!1,b&&b.context)}})})