(function(e){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):typeof exports=="object"?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)})(function(e){"use strict";e.support.fileInput=!new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)&&!e('<input type="file"/>').prop("disabled"),e.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);function t(t){var n=t==="dragover";return function(s){s.dataTransfer=s.originalEvent&&s.originalEvent.dataTransfer;var o=s.dataTransfer;o&&e.inArray("Files",o.types)!==-1&&this._trigger(t,e.Event(t,{delegatedEvent:s}))!==!1&&(s.preventDefault(),n&&(o.dropEffect="copy"))}}e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,uniqueFilenames:void 0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var s=e-this.timestamp;return(!this.bitrate||!n||s>n)&&(this.bitrate=(t-this.loaded)*(1e3/s)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return e.type(t.formData)==="function"?t.formData(t.form):e.isArray(t.formData)?t.formData:e.type(t.formData)==="object"?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)Object.prototype.hasOwnProperty.call(e._response,t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var o,s=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&s-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=s,o=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=o-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(s,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=o,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(s,o,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var s=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,s._onProgress(e,t)}),t.xhr=function(){return n})},_deinitProgressListener:function(t){var n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&e(n.upload).unbind("progress")},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_getUniqueFilename:function(e,t){return e=String(e),t[e]?(e=e.replace(/(?: \(([\d]+)\))?(\.[^.]+)?$/,function(e,t,n){var s=t?Number(t)+1:1,o=n||"";return" ("+s+")"+o}),this._getUniqueFilename(e,t)):(t[e]=!0,e)},_initXHRData:function(t){var n,o=this,s=t.files[0],a=t.multipart||!e.support.xhrFileUpload,i=e.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),(!a||t.blob||!this._isInstanceOf("File",s))&&(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(s.uploadName||s.name)+'"'),a?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:i,value:t.blob}):e.each(t.files,function(s,o){n.push({name:e.type(t.paramName)==="array"&&t.paramName[s]||i,value:o})})):(o._isInstanceOf("FormData",t.formData)?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(i,t.blob,s.uploadName||s.name):e.each(t.files,function(s,a){if(o._isInstanceOf("File",a)||o._isInstanceOf("Blob",a)){var r=a.uploadName||a.name;t.uniqueFilenames&&(r=o._getUniqueFilename(r,t.uniqueFilenames)),n.append(e.type(t.paramName)==="array"&&t.paramName[s]||i,a,r)}})),t.data=n):(t.contentType=s.type||"application/octet-stream",t.data=t.blob||s),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var s=e(t.fileInput),n=t.paramName;return n?e.isArray(n)||(n=[n]):(n=[],s.each(function(){for(var t=e(this),o=t.prop("name")||"files[]",s=(t.prop("files")||[1]).length;s;)n.push(o),s-=1}),n.length||(n=[s.prop("name")||"files[]"])),n},_initFormSettings:function(t){(!t.form||!t.form.length)&&(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||e.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase(),t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,s){var o=e.Deferred(),i=o.promise();return n=n||this.options.context||i,t===!0?o.resolveWith(n,s):t===!1&&o.rejectWith(n,s),i.abort=o.promise,this._enhancePromise(i)},_addConvenienceMethods:function(t,n){var s=this,o=function(t){return e.Deferred().resolveWith(s,t).promise()};n.process=function(t,i){return(t||i)&&(n._processQueue=this._processQueue=(this._processQueue||o([this])).then(function(){return n.errorThrown?e.Deferred().rejectWith(s,[n]).promise():o(arguments)}).then(t,i)),this._processQueue||o([this])},n.submit=function(){return this.state()!=="pending"&&(n.jqXHR=this.jqXHR=s._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&s._onSend(t,this)),this.jqXHR||s._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",s._trigger("fail",null,this),s._getXHRPromise(!1))},n.state=function(){if(this.jqXHR)return s._getDeferredState(this.jqXHR);if(this._processQueue)return s._getDeferredState(this._processQueue)},n.processing=function(){return!this.jqXHR&&this._processQueue&&s._getDeferredState(this._processQueue)==="pending"},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var n=e.getResponseHeader("Range"),t=n&&n.split("-"),s=t&&t.length>1&&parseInt(t[1],10);return s&&s+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var d,h,s=this,a=t.files[0],r=a.size,o=t.uploadedBytes,i=t.maxChunkSize||r,u=this._blobSlice,c=e.Deferred(),l=c.promise();return!!(this._isXHRUpload(t)&&u&&(o||(e.type(i)==="function"?i(t):i)<r))&&!t.data&&(!!n||(o>=r?(a.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",a.error])):(d=function(){var n=e.extend({},t),l=n._progress.loaded;n.blob=u.call(a,o,o+(e.type(i)==="function"?i(n):i),a.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+o+"-"+(o+n.chunkSize-1)+"/"+r,s._trigger("chunkbeforesend",null,n),s._initXHRData(n),s._initProgressListener(n),h=(s._trigger("chunksend",null,n)!==!1&&e.ajax(n)||s._getXHRPromise(!1,n.context)).done(function(i,a,u){o=s._getUploadedBytes(u)||o+n.chunkSize,l+n.chunkSize-n._progress.loaded&&s._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o-n.uploadedBytes,total:o-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=o,n.result=i,n.textStatus=a,n.jqXHR=u,s._trigger("chunkdone",null,n),s._trigger("chunkalways",null,n),o<r?d():c.resolveWith(n.context,[i,a,u])}).fail(function(e,t,o){n.jqXHR=e,n.textStatus=t,n.errorThrown=o,s._trigger("chunkfail",null,n),s._trigger("chunkalways",null,n),c.rejectWith(n.context,[e,t,o])}).always(function(){s._deinitProgressListener(n)})},this._enhancePromise(l),l.abort=function(){return h.abort()},d(),l)))},_beforeSend:function(e,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,s,o){var i=o._progress.total,a=o._response;o._progress.loaded<i&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:i,total:i}),o),a.result=o.result=t,a.textStatus=o.textStatus=n,a.jqXHR=o.jqXHR=s,this._trigger("done",null,o)},_onFail:function(e,t,n,s){var o=s._response;s.recalculateProgress&&(this._progress.loaded-=s._progress.loaded,this._progress.total-=s._progress.total),o.jqXHR=s.jqXHR=e,o.textStatus=s.textStatus=t,o.errorThrown=s.errorThrown=n,this._trigger("fail",null,s)},_onAlways:function(e,t,n,s){this._trigger("always",null,s)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var i,a,c,l,s=this,o=s._getAJAXSettings(n),r=function(){return s._sending+=1,o._bitrateTimer=new s._BitrateTimer,i=i||((c||s._trigger("send",e.Event("send",{delegatedEvent:t}),o)===!1)&&s._getXHRPromise(!1,o.context,c)||s._chunkedUpload(o)||e.ajax(o)).done(function(e,t,n){s._onDone(e,t,n,o)}).fail(function(e,t,n){s._onFail(e,t,n,o)}).always(function(e,t,n){if(s._deinitProgressListener(o),s._onAlways(e,t,n,o),s._sending-=1,s._active-=1,o.limitConcurrentUploads&&o.limitConcurrentUploads>s._sending)for(var i=s._slots.shift();i;){if(s._getDeferredState(i)==="pending"){i.resolve();break}i=s._slots.shift()}s._active===0&&s._trigger("stop")}),i};return this._beforeSend(t,o),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(a=e.Deferred(),this._slots.push(a),l=a.then(r)):(this._sequence=this._sequence.then(r,r),l=this._sequence),l.abort=function(){return c=[void 0,"abort","abort"],i?i.abort():(a&&a.rejectWith(o.context,c),r())},this._enhancePromise(l)):r()},_onAdd:function(t,n){var s,a,r,c,h=this,g=!0,i=e.extend({},this.options,n),o=n.files,m=o.length,l=i.limitMultiFileUploads,d=i.limitMultiFileUploadSize,v=i.limitMultiFileUploadSizeOverhead,p=0,u=this._getParamName(i),f=0;if(!m)return!1;if(d&&o[0].size===void 0&&(d=void 0),!(i.singleFileUploads||l||d)||!this._isXHRUpload(i))c=[o],r=[u];else if(!i.singleFileUploads&&!d&&l){c=[],r=[];for(s=0;s<m;s+=l)c.push(o.slice(s,s+l)),a=u.slice(s,s+l),a.length||(a=u),r.push(a)}else if(!i.singleFileUploads&&d){c=[],r=[];for(s=0;s<m;s=s+1)p+=o[s].size+v,(s+1===m||p+o[s+1].size+v>d||l&&s+1-f>=l)&&(c.push(o.slice(f,s+1)),a=u.slice(f,s+1),a.length||(a=u),r.push(a),f=s+1,p=0)}else r=u;return n.originalFiles=o,e.each(c||o,function(s,o){var i=e.extend({},n);return i.files=c?o:[o],i.paramName=r[s],h._initResponseObject(i),h._initProgressObject(i),h._addConvenienceMethods(t,i),g=h._trigger("add",e.Event("add",{delegatedEvent:t}),i),g}),g},_replaceFileInput:function(t){var n=t.fileInput,s=n.clone(!0),o=n.is(document.activeElement);t.fileInputClone=s,e("<form></form>").append(s)[0].reset(),n.after(s).detach(),o&&s.focus(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?s[0]:t}),n[0]===this.element[0]&&(this.element=s)},_handleFileTreeEntry:function(t,n){var a,c=this,s=e.Deferred(),o=[],i=function(e){e&&!e.entry&&(e.entry=t),s.resolve([e])},l=function(e){c._handleFileTreeEntries(e,n+t.name+"/").done(function(e){s.resolve(e)}).fail(i)},r=function(){a.readEntries(function(e){e.length?(o=o.concat(e),r()):l(o)},i)};return n=n||"",t.isFile?t._file?(t._file.relativePath=n,s.resolve(t._file)):t.file(function(e){e.relativePath=n,s.resolve(e)},i):t.isDirectory?(a=t.createReader(),r()):s.resolve([]),s.promise()},_handleFileTreeEntries:function(t,n){var s=this;return e.when.apply(e,e.map(t,function(e){return s._handleFileTreeEntry(e,n)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n,o,s=t.prop("webkitEntries")||t.prop("entries");if(s&&s.length)return this._handleFileTreeEntries(s);if(n=e.makeArray(t.prop("files")),n.length)n[0].name===void 0&&n[0].fileName&&e.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(o=t.prop("value"),!o)return e.Deferred().resolve([]).promise();n=[{name:o.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return!(t instanceof e)||t.length===1?this._getSingleFileInputFiles(t):e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var s=this,n={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(o){n.files=o,s.options.replaceFileInput&&s._replaceFileInput(n),s._trigger("change",e.Event("change",{delegatedEvent:t}),n)!==!1&&s._onAdd(t,n)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,s={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&s.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),s)!==!1&&this._onAdd(t,s))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var o=this,n=t.dataTransfer,s={};n&&n.files&&n.files.length&&(t.preventDefault(),this._getDroppedFiles(n).always(function(n){s.files=n,o._trigger("drop",e.Event("drop",{delegatedEvent:t}),s)!==!1&&o._onAdd(t,s)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,n){var s=e.inArray(t,this._specialOptions)!==-1;s&&this._destroyEventHandlers(),this._super(t,n),s&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===void 0?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return t!=="url"&&e.type(n)==="string"&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,s=this.element.data();e.each(this.element[0].attributes,function(e,o){var a,i=o.name.toLowerCase();/^data-/.test(i)&&(i=i.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),a=s[i],t._isRegExpOption(i,a)&&(a=t._getRegExp(a)),n[i]=a)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;if(!t||this.options.disabled)return;t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var s,i,a=this,n=e.Deferred(),o=n.promise();return o.abort=function(){return i=!0,s?s.abort():(n.reject(null,"abort","abort"),o)},this._getFileInputFiles(t.fileInput).always(function(e){if(i)return;if(!e.length){n.reject();return}t.files=e,s=a._onSend(null,t),s.then(function(e,t,s){n.resolve(e,t,s)},function(e,t,s){n.reject(e,t,s)})}),this._enhancePromise(o)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})})